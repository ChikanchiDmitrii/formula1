/*
 Platform.js <https://mths.be/platform>
 Copyright 2014-2018 Benjamin Tan <https://bnjmnt4n.now.sh/>
 Copyright 2011-2013 John-David Dalton
 Available under MIT license <https://mths.be/mit>
*/
(function(){var a="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},c="undefined"!==typeof module&&module.exports,b=function(){for(var l,g=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),
"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],h=0,d=g.length,k={};h<d;h++)if((l=g[h])&&l[1]in a){for(h=0;h<l.length;h++)k[g[0][h]]=l[h];return k}return!1}(),e={change:b.fullscreenchange,error:b.fullscreenerror},f={request:function(l){return new Promise(function(g,h){var d=function(){this.off("change",
d);g()}.bind(this);this.on("change",d);l=l||a.documentElement;Promise.resolve(l[b.requestFullscreen]())["catch"](h)}.bind(this))},exit:function(){return new Promise(function(l,g){if(this.isFullscreen){var h=function(){this.off("change",h);l()}.bind(this);this.on("change",h);Promise.resolve(a[b.exitFullscreen]())["catch"](g)}else l()}.bind(this))},toggle:function(l){return this.isFullscreen?this.exit():this.request(l)},onchange:function(l){this.on("change",l)},onerror:function(l){this.on("error",l)},
on:function(l,g){var h=e[l];h&&a.addEventListener(h,g,!1)},off:function(l,g){var h=e[l];h&&a.removeEventListener(h,g,!1)},raw:b};b?(Object.defineProperties(f,{isFullscreen:{get:function(){return!!a[b.fullscreenElement]}},element:{enumerable:!0,get:function(){return a[b.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return!!a[b.fullscreenEnabled]}}}),c?module.exports=f:window.screenfull=f):c?module.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})();
(function(){function a(q){q=String(q);return q.charAt(0).toUpperCase()+q.slice(1)}function c(q,E){var z=-1,A=q?q.length:0;if("number"==typeof A&&-1<A&&A<=m)for(;++z<A;)E(q[z],z,q);else e(q,E)}function b(q){q=String(q).replace(/^ +| +$/g,"");return/^(?:webOS|i(?:OS|P))/.test(q)?q:a(q)}function e(q,E){for(var z in q)w.call(q,z)&&E(q[z],z,q)}function f(q){return null==q?a(q):y.call(q).slice(8,-1)}function l(q,E){var z=null!=q?typeof q[E]:"number";return!/^(?:boolean|number|string|undefined)$/.test(z)&&
("object"==z?!!q[E]:!0)}function g(q){return String(q).replace(/([ -])(?!$)/g,"$1?")}function h(q,E){var z=null;c(q,function(A,C){z=E(z,A,C,q)});return z}function d(q){function E(T){return h(T,function(Q,P){var aa=P.pattern||g(P);!Q&&(Q=RegExp("\\b"+aa+" *\\d+[.\\w_]*","i").exec(q)||RegExp("\\b"+aa+" *\\w+-[\\w]*","i").exec(q)||RegExp("\\b"+aa+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(q))&&((Q=String(P.label&&!RegExp(aa,"i").test(P.label)?P.label:Q).split("/"))[1]&&!/[\d.]+/.test(Q[0])&&
(Q[0]+=" "+Q[1]),P=P.label||P,Q=b(Q[0].replace(RegExp(aa,"i"),P).replace(RegExp("; *(?:"+P+"[_-])?","i")," ").replace(RegExp("("+P+")[-_.]?(\\w)","i"),"$1 $2")));return Q})}function z(T){return h(T,function(Q,P){return Q||(RegExp(P+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(q)||0)[1]||null})}var A=n,C=q&&"object"==typeof q&&"String"!=f(q);C&&(A=q,q=null);var K=A.navigator||{},B=K.userAgent||"";q||(q=B);var O=C?!!K.likeChrome:/\bChrome\b/.test(q)&&!/internal|\n/i.test(y.toString()),
S=C?"Object":"ScriptBridgingProxyObject",V=C?"Object":"Environment",R=C&&A.java?"JavaPackage":f(A.java),W=C?"Object":"RuntimeObject";V=(R=/\bJava/.test(R)&&A.java)&&f(A.environment)==V;var X=R?"a":"\u03b1",Z=R?"b":"\u03b2",x=A.document||{},H=A.operamini||A.opera,I=t.test(I=C&&H?H["[[Class]]"]:f(H))?I:H=null,v,G=q;C=[];var L=null,J=q==B;B=J&&H&&"function"==typeof H.version&&H.version();var M=function(T){return h(T,function(Q,P){return Q||RegExp("\\b"+(P.pattern||g(P))+"\\b","i").exec(q)&&(P.label||
P)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),D=function(T){return h(T,function(Q,P){return Q||RegExp("\\b"+(P.pattern||g(P))+"\\b","i").exec(q)&&(P.label||P)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser",
"PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},
{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),N=E([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad",
"iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),U=function(T){return h(T,function(Q,P,aa){return Q||(P[N]||P[/^[a-z]+(?: +[a-z]+\b)*/i.exec(N)]||RegExp("\\b"+g(aa)+"(?:\\b|\\w*\\d)","i").exec(q))&&aa})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},
"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),F=function(T){return h(T,function(Q,P){var aa=P.pattern||g(P);if(!Q&&(Q=RegExp("\\b"+aa+"(?:/[\\d.]+|[ \\w.]*)","i").exec(q))){var ba=Q,ca=P.label||P,da={"10.0":"10","6.4":"10 Technical Preview",
"6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};aa&&ca&&/^Win/i.test(ba)&&!/^Windows Phone /i.test(ba)&&(da=da[/[\d.]+$/.exec(ba)])&&(ba="Windows "+da);ba=String(ba);aa&&ca&&(ba=ba.replace(RegExp(aa,"i"),ca));Q=ba=b(ba.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,
"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return Q})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X",
"Macintosh","Mac","Windows 98;","Windows "]);M&&(M=[M]);U&&!N&&(N=E([U]));if(v=/\bGoogle TV\b/.exec(N))N=v[0];/\bSimulator\b/i.test(q)&&(N=(N?N+" ":"")+"Simulator");"Opera Mini"==D&&/\bOPiOS\b/.test(q)&&C.push("running in Turbo/Uncompressed mode");"IE"==D&&/\blike iPhone OS\b/.test(q)?(v=d(q.replace(/like iPhone OS/,"")),U=v.manufacturer,N=v.product):/^iP/.test(N)?(D||(D="Safari"),F="iOS"+((v=/ OS ([\d_]+)/i.exec(q))?" "+v[1].replace(/_/g,"."):"")):"Konqueror"!=D||/buntu/i.test(F)?U&&"Google"!=U&&
(/Chrome/.test(D)&&!/\bMobile Safari\b/i.test(q)||/\bVita\b/.test(N))||/\bAndroid\b/.test(F)&&/^Chrome/.test(D)&&/\bVersion\//i.test(q)?(D="Android Browser",F=/\bAndroid\b/.test(F)?F:"Android"):"Silk"==D?(/\bMobi/i.test(q)||(F="Android",C.unshift("desktop mode")),/Accelerated *= *true/i.test(q)&&C.unshift("accelerated")):"PaleMoon"==D&&(v=/\bFirefox\/([\d.]+)\b/.exec(q))?C.push("identifying as Firefox "+v[1]):"Firefox"==D&&(v=/\b(Mobile|Tablet|TV)\b/i.exec(q))?(F||(F="Firefox OS"),N||(N=v[1])):!D||
(v=!/\bMinefield\b/i.test(q)&&/\b(?:Firefox|Safari)\b/.exec(D))?(D&&!N&&/[\/,]|^[^(]+?\)/.test(q.slice(q.indexOf(v+"/")+8))&&(D=null),(v=N||U||F)&&(N||U||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(F))&&(D=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(F)?F:v)+" Browser")):"Electron"==D&&(v=(/\bChrome\/([\d.]+)\b/.exec(q)||0)[1])&&C.push("Chromium "+v):F="Kubuntu";B||(B=z(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",g(D),
"(?:Firefox|Minefield|NetFront)"]));if(v="iCab"==M&&3<parseFloat(B)&&"WebKit"||/\bOpera\b/.test(D)&&(/\bOPR\b/.test(q)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(q)&&!/^(?:Trident|EdgeHTML)$/.test(M)&&"WebKit"||!M&&/\bMSIE\b/i.test(q)&&("Mac OS"==F?"Tasman":"Trident")||"WebKit"==M&&/\bPlayStation\b(?! Vita\b)/i.test(D)&&"NetFront")M=[v];"IE"==D&&(v=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(q)||0)[1])?(D+=" Mobile",F="Windows Phone "+(/\+$/.test(v)?v:v+".x"),C.unshift("desktop mode")):/\bWPDesktop\b/i.test(q)?
(D="IE Mobile",F="Windows Phone 8.x",C.unshift("desktop mode"),B||(B=(/\brv:([\d.]+)/.exec(q)||0)[1])):"IE"!=D&&"Trident"==M&&(v=/\brv:([\d.]+)/.exec(q))&&(D&&C.push("identifying as "+D+(B?" "+B:"")),D="IE",B=v[1]);if(J){if(l(A,"global"))if(R&&(v=R.lang.System,G=v.getProperty("os.arch"),F=F||v.getProperty("os.name")+" "+v.getProperty("os.version")),V){try{B=A.require("ringo/engine").version.join("."),D="RingoJS"}catch(T){(v=A.system)&&v.global.system==A.system&&(D="Narwhal",F||(F=v[0].os||null))}D||
(D="Rhino")}else"object"==typeof A.process&&!A.process.browser&&(v=A.process)&&("object"==typeof v.versions&&("string"==typeof v.versions.electron?(C.push("Node "+v.versions.node),D="Electron",B=v.versions.electron):"string"==typeof v.versions.nw&&(C.push("Chromium "+B,"Node "+v.versions.node),D="NW.js",B=v.versions.nw)),D||(D="Node.js",G=v.arch,F=v.platform,B=(B=/[\d.]+/.exec(v.version))?B[0]:null));else f(v=A.runtime)==S?(D="Adobe AIR",F=v.flash.system.Capabilities.os):f(v=A.phantom)==W?(D="PhantomJS",
B=(v=v.version||null)&&v.major+"."+v.minor+"."+v.patch):"number"==typeof x.documentMode&&(v=/\bTrident\/(\d+)/i.exec(q))?(B=[B,x.documentMode],(v=+v[1]+4)!=B[1]&&(C.push("IE "+B[1]+" mode"),M&&(M[1]=""),B[1]=v),B="IE"==D?String(B[1].toFixed(1)):B[0]):"number"==typeof x.documentMode&&/^(?:Chrome|Firefox)\b/.test(D)&&(C.push("masking as "+D+" "+B),D="IE",B="11.0",M=["Trident"],F="Windows");F=F&&b(F)}B&&(v=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(B)||/(?:alpha|beta)(?: ?\d)?/i.exec(q+";"+(J&&K.appMinorVersion))||
/\bMinefield\b/i.test(q)&&"a")&&(L=/b/i.test(v)?"beta":"alpha",B=B.replace(RegExp(v+"\\+?$"),"")+("beta"==L?Z:X)+(/\d+\+?/.exec(v)||""));if("Fennec"==D||"Firefox"==D&&/\b(?:Android|Firefox OS)\b/.test(F))D="Firefox Mobile";else if("Maxthon"==D&&B)B=B.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(N))"Xbox 360"==N&&(F=null),"Xbox 360"==N&&/\bIEMobile\b/.test(q)&&C.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(D)&&(!D||N||/Browser|Mobi/.test(D))||"Windows CE"!=F&&!/Mobi/i.test(q))if("IE"==
D&&J)try{null===A.external&&C.unshift("platform preview")}catch(T){C.unshift("embedded")}else(/\bBlackBerry\b/.test(N)||/\bBB10\b/.test(q))&&(v=(RegExp(N.replace(/ +/g," *")+"/([.\\d]+)","i").exec(q)||0)[1]||B)?(v=[v,/BB10/.test(q)],F=(v[1]?(N=null,U="BlackBerry"):"Device Software")+" "+v[0],B=null):this!=e&&"Wii"!=N&&(J&&H||/Opera/.test(D)&&/\b(?:MSIE|Firefox)\b/i.test(q)||"Firefox"==D&&/\bOS X (?:\d+\.){2,}/.test(F)||"IE"==D&&(F&&!/^Win/.test(F)&&5.5<B||/\bWindows XP\b/.test(F)&&8<B||8==B&&!/\bTrident\b/.test(q)))&&
!t.test(v=d.call(e,q.replace(t,"")+";"))&&v.name&&(v="ing as "+v.name+((v=v.version)?" "+v:""),t.test(D)?(/\bIE\b/.test(v)&&"Mac OS"==F&&(F=null),v="identify"+v):(v="mask"+v,D=I?b(I.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(v)&&(F=null),J||(B=null)),M=["Presto"],C.push(v));else D+=" Mobile";if(v=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(q)||0)[1]){v=[parseFloat(v.replace(/\.(\d)$/,".0$1")),v];if("Safari"==D&&"+"==v[1].slice(-1))D="WebKit Nightly",L="alpha",B=v[1].slice(0,-1);else if(B==
v[1]||B==(v[2]=(/\bSafari\/([\d.]+\+?)/i.exec(q)||0)[1]))B=null;v[1]=(/\bChrome\/([\d.]+)/i.exec(q)||0)[1];537.36==v[0]&&537.36==v[2]&&28<=parseFloat(v[1])&&"WebKit"==M&&(M=["Blink"]);J&&(O||v[1])?(M&&(M[1]="like Chrome"),v=v[1]||(v=v[0],530>v?1:532>v?2:532.05>v?3:533>v?4:534.03>v?5:534.07>v?6:534.1>v?7:534.13>v?8:534.16>v?9:534.24>v?10:534.3>v?11:535.01>v?12:535.02>v?"13+":535.07>v?15:535.11>v?16:535.19>v?17:536.05>v?18:536.1>v?19:537.01>v?20:537.11>v?"21+":537.13>v?23:537.18>v?24:537.24>v?25:537.36>
v?26:"Blink"!=M?"27":"28")):(M&&(M[1]="like Safari"),v=(v=v[0],400>v?1:500>v?2:526>v?3:533>v?4:534>v?"4+":535>v?5:537>v?6:538>v?7:601>v?8:"8"));M&&(M[1]+=" "+(v+="number"==typeof v?".x":/[.+]/.test(v)?"":"+"));"Safari"==D&&(!B||45<parseInt(B))&&(B=v)}"Opera"==D&&(v=/\bzbov|zvav$/.exec(F))?(D+=" ",C.unshift("desktop mode"),"zvav"==v?(D+="Mini",B=null):D+="Mobile",F=F.replace(RegExp(" *"+v+"$"),"")):"Safari"==D&&/\bChrome\b/.exec(M&&M[1])&&(C.unshift("desktop mode"),D="Chrome Mobile",B=null,/\bOS X\b/.test(F)?
(U="Apple",F="iOS 4.3+"):F=null);B&&0==B.indexOf(v=/[\d.]+$/.exec(F))&&-1<q.indexOf("/"+v+"-")&&(F=String(F.replace(v,"")).replace(/^ +| +$/g,""));M&&!/\b(?:Avant|Nook)\b/.test(D)&&(/Browser|Lunascape|Maxthon/.test(D)||"Safari"!=D&&/^iOS/.test(F)&&/\bSafari\b/.test(M[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(D)&&M[1])&&(v=M[M.length-1])&&C.push(v);C.length&&(C=["("+C.join("; ")+")"]);U&&N&&0>N.indexOf(U)&&C.push("on "+U);N&&C.push((/^on /.test(C[C.length-
1])?"":"on ")+N);if(F){var Y=(v=/ ([\d.+]+)$/.exec(F))&&"/"==F.charAt(F.length-v[0].length-1);F={architecture:32,family:v&&!Y?F.replace(v[0],""):F,version:v?v[1]:null,toString:function(){var T=this.version;return this.family+(T&&!Y?" "+T:"")+(64==this.architecture?" 64-bit":"")}}}(v=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(G))&&!/\bi686\b/i.test(G)?(F&&(F.architecture=64,F.family=F.family.replace(RegExp(" *"+v),"")),D&&(/\bWOW64\b/i.test(q)||J&&/\w(?:86|32)$/.test(K.cpuClass||K.platform)&&!/\bWin64; x64\b/i.test(q))&&
C.unshift("32-bit")):F&&/^OS X/.test(F.family)&&"Chrome"==D&&39<=parseFloat(B)&&(F.architecture=64);q||(q=null);A={};A.description=q;A.layout=M&&M[0];A.manufacturer=U;A.name=D;A.prerelease=L;A.product=N;A.ua=q;A.version=D&&B;A.os=F||{architecture:null,family:null,version:null,toString:function(){return"null"}};A.parse=d;A.toString=function(){return this.description||""};A.version&&C.unshift(B);A.name&&C.unshift(D);F&&D&&(F!=String(F).split(" ")[0]||F!=D.split(" ")[0]&&!N)&&C.push(N?"("+F+")":"on "+
F);C.length&&(A.description=C.join(" "));return A}var k={"function":!0,object:!0},n=k[typeof window]&&window||this,p=k[typeof exports]&&exports;k=k[typeof module]&&module&&!module.nodeType&&module;var r=p&&k&&"object"==typeof global&&global;!r||r.global!==r&&r.window!==r&&r.self!==r||(n=r);var m=Math.pow(2,53)-1,t=/\bOpera/;r=Object.prototype;var w=r.hasOwnProperty,y=r.toString,u=d();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(n.platform=u,define(function(){return u})):p&&
k?e(u,function(q,E){p[E]=q}):n.platform=u}).call(this);
function buildIOSMeta(){for(var a=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],c=0;c<a.length;c++){var b=document.createElement("meta");b.name=a[c].name;b.content=a[c].content;var e=window.document.head.querySelector('meta[name="'+b.name+'"]');e&&e.parentNode.removeChild(e);window.document.head.appendChild(b)}}
function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none");jQuery(".xxx-ios-fullscreen-scroll").css("display","none");jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}
function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block");jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}
function __iosResize(){window.scrollTo(0,0);console.log(window.devicePixelRatio);console.log(window.innerWidth);console.log(window.innerHeight);if("iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();
break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize();setTimeout(function(){__iosResize()},500)}
function iosInIframe(){try{return window.self!==window.top}catch(a){return!0}}function isIOSLessThen13(){var a=platform.os,c=a.family.toLowerCase();a=parseFloat(a.version);return"ios"===c&&13>a?!0:!1}$(document).ready(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&(buildIOSFullscreenPanel(),buildIOSMeta())});
jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&iosResize()});var s_iScaleFactor=1,s_iOffsetX,s_iOffsetY,s_bIsIphone=!1,s_bLandscape=!1,s_bFocus=!0;
(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(a.substr(0,
4))})(navigator.userAgent||navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(a){console.log(a)}
function getSize(a){var c=a.toLowerCase(),b=window.document,e=b.documentElement;if(void 0===window["inner"+a])a=e["client"+a];else if(window["inner"+a]!=e["client"+a]){var f=b.createElement("body");f.id="vpw-test-b";f.style.cssText="overflow:scroll";var l=b.createElement("div");l.id="vpw-test-d";l.style.cssText="position:absolute;top:-1000px";l.innerHTML="<style>@media("+c+":"+e["client"+a]+"px){body#vpw-test-b div#vpw-test-d{"+c+":7px!important}}</style>";f.appendChild(l);e.insertBefore(f,b.head);
a=7==l["offset"+a]?e["client"+a]:window["inner"+a];e.removeChild(f)}else a=window["inner"+a];return a}window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}
function isIpad(){var a=-1!==navigator.userAgent.toLowerCase().indexOf("ipad");return!a&&navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints?!0:a}function isMobile(){return isIpad()?!0:jQuery.browser.mobile}
function isIOS(){var a="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");if(-1!==navigator.userAgent.toLowerCase().indexOf("iphone"))return s_bIsIphone=!0;for(;a.length;)if(navigator.platform===a.pop())return s_bIsIphone=!0;return s_bIsIphone=!1}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}
function getHeightOfIOSToolbars(){var a=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<a?a:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var a="safari"===platform.name.toLowerCase()?getIOSWindowHeight():getSize("Height");var c=getSize("Width");s_bFocus&&_checkOrientation(c,a);var b=Math.min(a/CANVAS_HEIGHT,c/CANVAS_WIDTH);c>a?(EDGEBOARD_X=0,EDGEBOARD_Y=550,s_bLandscape=!0):(EDGEBOARD_X=550,EDGEBOARD_Y=0,s_bLandscape=!1);var e=Math.round(CANVAS_WIDTH*b);b=Math.round(CANVAS_HEIGHT*b);if(b<a){var f=a-b;b+=f;e+=CANVAS_WIDTH/CANVAS_HEIGHT*f}else e<c&&(f=c-e,e+=f,b+=CANVAS_HEIGHT/
CANVAS_WIDTH*f);f=a/2-b/2;var l=c/2-e/2,g=CANVAS_WIDTH/e;if(l*g<-EDGEBOARD_X||f*g<-EDGEBOARD_Y)b=Math.min(a/(CANVAS_HEIGHT-2*EDGEBOARD_Y),c/(CANVAS_WIDTH-2*EDGEBOARD_X)),e=Math.round(CANVAS_WIDTH*b),b=Math.round(CANVAS_HEIGHT*b),f=(a-b)/2,l=(c-e)/2,g=CANVAS_WIDTH/e;s_iOffsetX=-1*l*g;s_iOffsetY=-1*f*g;0<=f&&(s_iOffsetY=0);0<=l&&(s_iOffsetX=0);null!==s_oGame&&s_oGame.refreshButtonPos();null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);$("#canvas").css("width",e+"px");$("#canvas").css("height",
b+"px");0>f||(f=(a-b)/2);$("#canvas").css("top",f+"px");$("#canvas").css("left",l+"px");fullscreenHandler()}}
function _checkOrientation(a,c){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(a>c?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function inRectResize(a,c,b){c=_getNormalizedSize(a.width,c);a=_getNormalizedSize(a.height,b);return Math.min(c,a)}function _getNormalizedSize(a,c){return c/a}function playSound(a,c,b){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[a].play(),s_aSounds[a].volume(c),s_aSounds[a].loop(b),s_aSounds[a]):null}function stopSound(a){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||a.stop()}function setVolume(a,c){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||a.volume(c)}
function setMute(a,c){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||a.mute(c)}function fadeSound(a,c,b,e){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||a.fade(c,b,e)}function soundPlaying(a){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)return a.playing()}function soundSeek(a,c){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)return a.seek(c)}function soundDuration(a){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)return a.duration()}
function createBitmap(a,c,b){var e=new createjs.Bitmap(a),f=new createjs.Shape;c&&b?f.graphics.beginFill("#fff").drawRect(0,0,c,b):f.graphics.beginFill("#ff0").drawRect(0,0,a.width,a.height);e.hitArea=f;return e}function createSprite(a,c,b,e,f,l){a=null!==c?new createjs.Sprite(a,c):new createjs.Sprite(a);c=new createjs.Shape;c.graphics.beginFill("#000000").drawRect(-b,-e,f,l);a.hitArea=c;return a}function pad(a,c,b){a+="";return a.length>=c?a:Array(c-a.length+1).join(b||"0")+a}
function randomFloatBetween(a,c,b){"undefined"===typeof b&&(b=2);return parseFloat(Math.min(a+Math.random()*(c-a),c).toFixed(b))}function rotateVector2D(a,c){var b=c.getX()*Math.cos(a)+c.getY()*Math.sin(a),e=c.getX()*-Math.sin(a)+c.getY()*Math.cos(a);c.set(b,e)}function rotateSimpleVector2D(a,c){return{x:c.x*Math.cos(a)+c.y*Math.sin(a),y:c.x*-Math.sin(a)+c.y*Math.cos(a)}}function tweenVectorsOnX(a,c,b){return a+b*(c-a)}function linearFunction(a,c,b,e,f){return(a-c)*(f-e)/(b-c)+e}
function percentScale(a,c){return a*c/100}function shuffle(a){for(var c=a.length,b,e;0!==c;)e=Math.floor(Math.random()*c),--c,b=a[c],a[c]=a[e],a[e]=b;return a}function bubbleSort(a){do{var c=!1;for(var b=0;b<a.length-1;b++)a[b]>a[b+1]&&(c=a[b],a[b]=a[b+1],a[b+1]=c,c=!0)}while(c)}function compare(a,c){return a.index>c.index?-1:a.index<c.index?1:0}function easeLinear(a,c,b,e){return b*a/e+c}function easeInQuad(a,c,b,e){return b*(a/=e)*a+c}
function easeInSine(a,c,b,e){return-b*Math.cos(a/e*(Math.PI/2))+b+c}function easeInCubic(a,c,b,e){return b*(a/=e)*a*a+c}function getTrajectoryPoint(a,c){var b=new createjs.Point,e=(1-a)*(1-a),f=a*a;b.x=e*c.start.x+2*(1-a)*a*c.traj.x+f*c.end.x;b.y=e*c.start.y+2*(1-a)*a*c.traj.y+f*c.end.y;return b}function formatTime(a){a/=1E3;var c=Math.floor(a/60);a=parseFloat(a-60*c).toFixed(1);var b="";b=10>c?b+("0"+c+":"):b+(c+":");return 10>a?b+("0"+a):b+a}
function ordinal(a){var c=["th","st","nd","rd"],b=a%100;return a+(c[(b-20)%10]||c[b]||c[0])}function ordinalSuffix(a){var c=["th","st","nd","rd"];a%=100;return c[(a-20)%10]||c[a]||c[0]}function degreesToRadians(a){return a*Math.PI/180}function checkRectCollision(a,c){var b=getBounds(a,.9);var e=getBounds(c,.98);return calculateIntersection(b,e)}
function calculateIntersection(a,c){var b,e,f,l;var g=a.x+(b=a.width/2);var h=a.y+(e=a.height/2);var d=c.x+(f=c.width/2);var k=c.y+(l=c.height/2);g=Math.abs(g-d)-(b+f);h=Math.abs(h-k)-(e+l);return 0>g&&0>h?(g=Math.min(Math.min(a.width,c.width),-g),h=Math.min(Math.min(a.height,c.height),-h),{x:Math.max(a.x,c.x),y:Math.max(a.y,c.y),width:g,height:h,rect1:a,rect2:c}):null}
function getBounds(a,c){var b={x:Infinity,y:Infinity,width:0,height:0};if(a instanceof createjs.Container){b.x2=-Infinity;b.y2=-Infinity;var e=a.children,f=e.length,l;for(l=0;l<f;l++){var g=getBounds(e[l],1);g.x<b.x&&(b.x=g.x);g.y<b.y&&(b.y=g.y);g.x+g.width>b.x2&&(b.x2=g.x+g.width);g.y+g.height>b.y2&&(b.y2=g.y+g.height)}Infinity==b.x&&(b.x=0);Infinity==b.y&&(b.y=0);Infinity==b.x2&&(b.x2=0);Infinity==b.y2&&(b.y2=0);b.width=b.x2-b.x;b.height=b.y2-b.y;delete b.x2;delete b.y2}else{if(a instanceof createjs.Bitmap){f=
a.sourceRect||a.image;l=f.width*c;var h=f.height*c}else if(a instanceof createjs.Sprite)if(a.spriteSheet._frames&&a.spriteSheet._frames[a.currentFrame]&&a.spriteSheet._frames[a.currentFrame].image){f=a.spriteSheet.getFrame(a.currentFrame);l=f.rect.width;h=f.rect.height;e=f.regX;var d=f.regY}else b.x=a.x||0,b.y=a.y||0;else b.x=a.x||0,b.y=a.y||0;e=e||0;l=l||0;d=d||0;h=h||0;b.regX=e;b.regY=d;f=a.localToGlobal(0-e,0-d);g=a.localToGlobal(l-e,h-d);l=a.localToGlobal(l-e,0-d);e=a.localToGlobal(0-e,h-d);b.x=
Math.min(Math.min(Math.min(f.x,g.x),l.x),e.x);b.y=Math.min(Math.min(Math.min(f.y,g.y),l.y),e.y);b.width=Math.max(Math.max(Math.max(f.x,g.x),l.x),e.x)-b.x;b.height=Math.max(Math.max(Math.max(f.y,g.y),l.y),e.y)-b.y}return b}function NoClickDelay(a){this.element=a;window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(a){for(var c=a.length,b,e;0<c;)e=Math.floor(Math.random()*c),c--,b=a[c],a[c]=a[e],a[e]=b;return a}
NoClickDelay.prototype={handleEvent:function(a){switch(a.type){case "touchstart":this.onTouchStart(a);break;case "touchmove":this.onTouchMove(a);break;case "touchend":this.onTouchEnd(a)}},onTouchStart:function(a){a.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(a){this.moved=!0},onTouchEnd:function(a){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){a=document.elementFromPoint(a.changedTouches[0].clientX,a.changedTouches[0].clientY);3==a.nodeType&&(a=a.parentNode);var c=document.createEvent("MouseEvents");c.initEvent("click",!0,!0);a.dispatchEvent(c)}}};
(function(){function a(b){var e={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};b=b||window.event;b.type in e?document.body.className=e[b.type]:(document.body.className=this[c]?"hidden":"visible","hidden"===document.body.className?(s_oMain.stopUpdate(),s_bFocus=!1):(s_oMain.startUpdate(),s_bFocus=!0))}var c="hidden";c in document?document.addEventListener("visibilitychange",a):(c="mozHidden")in document?document.addEventListener("mozvisibilitychange",
a):(c="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",a):(c="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?document.onfocusin=document.onfocusout=a:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=a})();function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}
function getParamValue(a){for(var c=window.location.search.substring(1).split("&"),b=0;b<c.length;b++){var e=c[b].split("=");if(e[0]==a)return e[1]}}
var Util={timestamp:function(){return(new Date).getTime()},toInt:function(a,c){if(null!==a){var b=parseInt(a,10);if(!isNaN(b))return b}return Util.toInt(c,0)},toFloat:function(a,c){if(null!==a){var b=parseFloat(a);if(!isNaN(b))return b}return Util.toFloat(c,0)},limit:function(a,c,b){return Math.max(c,Math.min(a,b))},randomInt:function(a,c){return Math.round(Util.interpolate(a,c,Math.random()))},randomChoice:function(a){return a[Util.randomInt(0,a.length-1)]},percentRemaining:function(a,c){return a%
c/c},accelerate:function(a,c,b){return a+c*b},interpolate:function(a,c,b){return a+(c-a)*b},easeIn:function(a,c,b){return a+(c-a)*Math.pow(b,2)},easeOut:function(a,c,b){return a+(c-a)*(1-Math.pow(1-b,2))},easeInOut:function(a,c,b){return a+(c-a)*(-Math.cos(b*Math.PI)/2+.5)},exponentialFog:function(a,c){return 1/Math.pow(Math.E,a*a*c)},easeInQuint:function(a,c,b){return a+(c-a)*Math.pow(b,5)},easeOutQuint:function(a,c,b){return a+(c-a)*(1-Math.pow(1-b,5))},increase:function(a,c,b){for(a+=c;a>=b;)a-=
b;for(;0>a;)a+=b;return a},project:function(a,c,b,e,f){a.camera.x=-c;a.camera.y=a.world.y-b;a.camera.z=a.world.z-e;a.screen.scale=f/a.camera.z;a.screen.x=HALF_CANVAS_WIDTH+a.screen.scale*a.camera.x*HALF_CANVAS_WIDTH;a.screen.y=HALF_CANVAS_HEIGHT-a.screen.scale*a.camera.y*HALF_CANVAS_HEIGHT;a.screen.w=a.screen.scale*ROAD_PER_HALF_CANVAS_WIDTH;a.projectX=c},overlap:function(a,c,b,e,f){f=.5*(f||1);return!(a+c*f<b-e*f||a-c*f>b+e*f)},get3dto2dCoord:function(a,c,b,e,f){e=f/(a.z-e);return{x:HALF_CANVAS_WIDTH+
e*(a.x-c)*HALF_CANVAS_WIDTH,y:HALF_CANVAS_HEIGHT-e*(a.y-b)*HALF_CANVAS_HEIGHT,scale:e}}};function getModule(a,c){return(a%c+c)%c}function copyObjectByValue(a){return JSON.parse(JSON.stringify(a))}function fullscreenHandler(){ENABLE_FULLSCREEN&&screenfull.isEnabled&&(s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut())}
if(screenfull.isEnabled)screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen;null!==s_oInterface&&s_oInterface.resetFullscreenBut();null!==s_oMenu&&s_oMenu.resetFullscreenBut()});
function CSpriteLibrary(){var a={},c,b,e,f,l,g,h,d;this.init=function(k,n,p){c={};e=b=0;f=k;l=n;g=p};this.addSprite=function(k,n){if(a.hasOwnProperty(k))return!1;var p=new Image;a[k]=c[k]={szPath:n,oSprite:p,bLoaded:!1};b++;return!0};this.getSprite=function(k){return a.hasOwnProperty(k)?a[k].oSprite:null};this._onSpritesLoaded=function(){b=0;l.call(g)};this._onSpriteLoaded=function(){f.call(g);++e===b&&this._onSpritesLoaded()};this.loadSprites=function(k){var n=Object.keys(c).length,p=n;k&&(p=Math.ceil(n/
k));this._fillGroup(n,p);this._startLoadingGroup()};this._fillGroup=function(k,n){h=[];var p=0,r=0;h[r]={};for(var m in c)h[r][m]=c[m],p++,k--,p===n&&(p=0,r++,0<k&&(h[r]={}))};this._startLoadingGroup=function(){d=0;this._loadSpriteGroup(h[d])};this._onGroupLoaded=function(){d++;d<h.length&&this._loadSpriteGroup(h[d])};this._loadSpriteGroup=function(k){var n=Object.keys(k).length,p;for(p in k)k[p].oSprite.oSpriteLibrary=this,k[p].oSprite.szKey=p,k[p].oSprite.onload=function(){this.oSpriteLibrary.setLoaded(this.szKey);
this.oSpriteLibrary._onSpriteLoaded(this.szKey);n--;0===n&&this.oSpriteLibrary._onGroupLoaded()},k[p].oSprite.onerror=function(r){var m=r.currentTarget;setTimeout(function(){k[m.szKey].oSprite.src=k[m.szKey].szPath},500)},k[p].oSprite.src=k[p].szPath};this.setLoaded=function(k){a[k].bLoaded=!0};this.isLoaded=function(k){return a[k].bLoaded};this.getNumSprites=function(){return b}}
function CTextButton(a,c,b,e,f,l,g){var h,d,k,n,p,r,m;this._init=function(t,w,y,u,q,E,z){h=[];d=[];var A=createBitmap(y),C=Math.ceil(z/20);m=new createjs.Text(u,z+"px "+q,"#000000");m.textAlign="center";m.textBaseline="alphabetic";var K=m.getBounds();m.x=y.width/2+C;m.y=Math.floor(y.height/2)+K.height/3+C;r=new createjs.Text(u,z+"px "+q,E);r.textAlign="center";r.textBaseline="alphabetic";K=r.getBounds();r.x=y.width/2;r.y=Math.floor(y.height/2)+K.height/3;p=new createjs.Container;p.x=t;p.y=w;p.regX=
y.width/2;p.regY=y.height/2;p.addChild(A,m,r);s_oStage.addChild(p);this._initListener()};this.unload=function(){p.off("mousedown",k);p.off("pressup",n);s_oStage.removeChild(p)};this.setVisible=function(t){p.visible=t};this._initListener=function(){k=p.on("mousedown",this.buttonDown);n=p.on("pressup",this.buttonRelease)};this.addEventListener=function(t,w,y){h[t]=w;d[t]=y};this.buttonRelease=function(){p.scaleX=1;p.scaleY=1;h[ON_MOUSE_UP]&&h[ON_MOUSE_UP].call(d[ON_MOUSE_UP])};this.buttonDown=function(){p.scaleX=
.9;p.scaleY=.9;h[ON_MOUSE_DOWN]&&h[ON_MOUSE_DOWN].call(d[ON_MOUSE_DOWN])};this.setTextPosition=function(t){r.y=t;m.y=t+2};this.setPosition=function(t,w){p.x=t;p.y=w};this.setX=function(t){p.x=t};this.setY=function(t){p.y=t};this.getButtonImage=function(){return p};this.getX=function(){return p.x};this.getY=function(){return p.y};this._init(a,c,b,e,f,l,g);return this}
function CToggle(a,c,b,e){var f,l,g,h,d,k;this._init=function(n,p,r,m){l=[];g=[];var t=new createjs.SpriteSheet({images:[r],frames:{width:r.width/2,height:r.height,regX:r.width/2/2,regY:r.height/2},animations:{state_true:[0],state_false:[1]}});f=m;k=createSprite(t,"state_"+f,r.width/2/2,r.height/2,r.width/2,r.height);k.x=n;k.y=p;k.stop();s_oStage.addChild(k);this._initListener()};this.unload=function(){k.off("mousedown",h);k.off("pressup",d);s_oStage.removeChild(k)};this._initListener=function(){h=
k.on("mousedown",this.buttonDown);d=k.on("pressup",this.buttonRelease)};this.addEventListener=function(n,p,r){l[n]=p;g[n]=r};this.setActive=function(n){f=n;k.gotoAndStop("state_"+f)};this.buttonRelease=function(){k.scaleX=1;k.scaleY=1;playSound("click",1,!1);f=!f;k.gotoAndStop("state_"+f);l[ON_MOUSE_UP]&&l[ON_MOUSE_UP].call(g[ON_MOUSE_UP],f)};this.buttonDown=function(){k.scaleX=.9;k.scaleY=.9;l[ON_MOUSE_DOWN]&&l[ON_MOUSE_DOWN].call(g[ON_MOUSE_DOWN])};this.setPosition=function(n,p){k.x=n;k.y=p};this.setMask=
function(n){k.mask=n};this.getButtonImage=function(){return k};this._init(a,c,b,e)}
function CGfxButton(a,c,b,e){var f,l,g,h,d,k=[],n,p,r,m;this._init=function(t,w,y,u){f=!1;l=!0;g=1;h=[];d=[];m=new createjs.Container;m.x=t;m.y=w;m.scaleX=m.scaleY=g;u.addChild(m);t=createBitmap(y);t.regX=y.width/2;t.regY=y.height/2;m.addChild(t);this._initListener()};this.unload=function(){m.off("mousedown",n);m.off("pressup",p);s_bMobile||m.off("mouseover",r);e.removeChild(m)};this.setVisible=function(t){m.visible=t};this.setClickable=function(t){f=!t};this._initListener=function(){n=m.on("mousedown",
this.buttonDown);p=m.on("pressup",this.buttonRelease);s_bMobile||(r=m.on("mouseover",this.buttonOver))};this.addEventListener=function(t,w,y){h[t]=w;d[t]=y};this.addEventListenerWithParams=function(t,w,y,u){h[t]=w;d[t]=y;k=u};this.buttonRelease=function(){f||(l&&(m.scaleX=g,m.scaleY=g),h[ON_MOUSE_UP]&&h[ON_MOUSE_UP].call(d[ON_MOUSE_UP],k))};this.buttonDown=function(){f||(l&&(m.scaleX=.9*g,m.scaleY=.9*g),playSound("click",1,!1),h[ON_MOUSE_DOWN]&&h[ON_MOUSE_DOWN].call(d[ON_MOUSE_DOWN],k))};this.buttonOver=
function(t){s_bMobile||f||(t.target.cursor="pointer")};this.pulseAnimation=function(){createjs.Tween.get(m,{loop:!0}).to({scaleX:1.1*g,scaleY:1.1*g},850,createjs.Ease.quadOut).to({scaleX:g,scaleY:g},650,createjs.Ease.quadIn)};this.trembleAnimation=function(){createjs.Tween.get(m,{loop:!0}).to({rotation:5},75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750)};this.setPosition=function(t,w){m.x=t;m.y=w};this.setX=function(t){m.x=t};
this.setY=function(t){m.y=t};this.setScalableOnClick=function(t){l=t};this.setMask=function(t){m.mask=t};this.getButtonImage=function(){return m};this.getX=function(){return m.x};this.getY=function(){return m.y};this._init(a,c,b,e);return this}
var Render={segment:function(a,c,b,e,f,l,g,h,d,k){var n=Render.rumbleWidth(l,b),p=Render.rumbleWidth(d,b),r=Render.laneMarkerWidth(l,b),m=Render.laneMarkerWidth(d,b);a.graphics.beginFill(k.grass);a.graphics.drawRect(START_X_ROTATION_VIEW,h,c,f-h);Render.simplePolygon(a,e-l-n,f,e-l,f,g-d,h,g-d-p,h,k.rumble);Render.simplePolygon(a,e+l+n,f,e+l,f,g+d,h,g+d+p,h,k.rumble);Render.simplePolygon(a,e-l,f,e+l,f,g+d,h,g-d,h,k.road);if(k.lane)for(c=2*l/b,n=2*d/b,e=e-l+c,g=g-d+n,d=1;d<b;e+=c,g+=n,d++)Render.simplePolygon(a,
e-r/2,f,e+r/2,f,g+m/2,h,g-m/2,h,k.lane)},simplePolygon:function(a,c,b,e,f,l,g,h,d,k){a.graphics.beginFill(k);a.graphics.moveTo(c,b);a.graphics.lineTo(e,f);a.graphics.lineTo(l,g);a.graphics.lineTo(h,d)},polygon:function(a,c,b,e,f,l,g,h,d,k){a.graphics.moveTo(c,b);a.graphics.lineTo(e,f);a.graphics.lineTo(l,g);a.graphics.lineTo(h,d)},simpleSegment:function(a,c,b,e,f,l,g,h,d,k,n){Render.polygon(a,e-l,f,e+l,f,g+d,h,g-d,h)},grass:function(a,c,b,e,f,l,g,h,d,k){a.graphics.drawRect(START_X_ROTATION_VIEW,h,
c,f-h)},rumble:function(a,c,b,e,f,l,g,h,d,k){c=Render.rumbleWidth(2*l,b);b=Render.rumbleWidth(2*d,b);var n=e+l,p=g+d,r=g-d-b;a.graphics.moveTo(e-l-c,f);a.graphics.lineTo(n,f);a.graphics.moveTo(p,h);a.graphics.lineTo(r,h);Render.simplePolygon(a,e-l-c,f,e-l,f,g-d,h,g-d-b,h,k.rumble);Render.simplePolygon(a,e+l+c,f,e+l,f,g+d,h,g+d+b,h,k.rumble)},centralLane:function(a,c,b,e,f,l,g,h,d,k){Render.rumbleWidth(l,b);Render.rumbleWidth(d,b);c=Render.laneMarkerWidth(l,b);var n=Render.laneMarkerWidth(d,b);if(k.lane){k=
2*l/b;var p=2*d/b;e=e-l+k;g=g-d+p;for(d=1;d<b;e+=k,g+=p,d++)Render.polygon(a,e-c/2,f,e+c/2,f,g+n/2,h,g-n/2,h)}},stroke:function(a,c,b,e,f,l,g,h,d,k){c=g-d;a.graphics.moveTo(e-l,f);a.graphics.lineTo(c,h);c=g+d;a.graphics.moveTo(e+l,f);a.graphics.lineTo(c,h)},background:function(a,c,b,e,f,l,g){var h=f.w/2;l=f.x+Math.floor(f.w*(l||0));var d=f.y,k=Math.min(h,f.x+f.w-l),n=f.h;g=g||0;var p=Math.floor(k/h*b);a.drawImage(c,l,d,k,n,0,g,p,e);k<h&&a.drawImage(c,f.x,d,h-k,n,p-1,g,b-p,e)},sprite:function(a,c,
b,e,f,l,g,h){var d=a.width*b;b*=a.height;f+=b*(g||0);g=h?Math.max(0,f+b-h):0;g<b?(e+=d*(l||0),c.x=e,c.y=f,c.scaleX=c.scaleY=b/a.height,a=new createjs.Rectangle(0,0,a.width,a.height-a.height*g/b),c.sourceRect=a):c.visible=!1},spriteWithMask:function(a,c,b,e,f,l,g,h,d){var k=a.width*b;b*=a.height;f+=b*(g||0);g=h?Math.max(0,f+b-h):0;g<b?(e+=k*(l||0),c.x=e,c.y=f,c.scaleX=c.scaleY=b/a.height,d.scaleY=1-g/b):c.visible=!1},rumbleWidth:function(a,c){return a/Math.max(6,2*c)},laneMarkerWidth:function(a,c){return a/
Math.max(32,8*c)}},LOCALSTORAGE_TIMES="times",LOCALSTORAGE_LEVELSCORE="levelscore",LOCALSTORAGE_TOTALSCORE="totalscore",s_aTimeScore=[],s_aLevelScore=[],s_iTotalScore=0;
function CLocalStorage(a){var c=!0;this._init=function(b){try{var e=window.localStorage.getItem(b);this.resetData();null!==e&&void 0!==e&&this.loadData()}catch(f){this.resetData()}};this.isDirty=function(){for(var b=0;b<s_aLevelScore.length;b++)if(0<s_aLevelScore[b])return!0;return!1};this.isUsed=function(){try{window.localStorage.setItem("ls_available","ok")}catch(b){c=!1}return c};this.resetData=function(){s_aTimeScore=[];for(var b=0;b<NUM_TRACKS_PER_WORLD*NUM_WORLDS;b++)s_aTimeScore[b]=0;s_aLevelScore=
[];for(b=0;b<NUM_TRACKS_PER_WORLD*NUM_WORLDS;b++)s_aLevelScore[b]=0;s_iTotalScore=0};this.deleteData=function(){window.localStorage.removeItem(a)};this.saveData=function(){var b={};b[LOCALSTORAGE_LEVELSCORE]=s_aLevelScore;b[LOCALSTORAGE_TIMES]=s_aTimeScore;b[LOCALSTORAGE_TOTALSCORE]=s_iTotalScore;window.localStorage.setItem(a,JSON.stringify(b))};this.loadData=function(){var b=JSON.parse(window.localStorage.getItem(a)),e=b[LOCALSTORAGE_LEVELSCORE];s_aLevelScore=[];for(var f=0;f<e.length;f++)s_aLevelScore[f]=
parseInt(e[f]);e=b[LOCALSTORAGE_TIMES];s_aTimeScore=[];for(f=0;f<e.length;f++)s_aTimeScore[f]=parseInt(e[f]);s_iTotalScore=parseInt(b[LOCALSTORAGE_TOTALSCORE])};this._init(a)}
CTLText.prototype={constructor:CTLText,__autofit:function(){if(this._bFitText){var a=this._szMsg,c=3>a.length?!1:this._bEllipsis;if(c||this._bMultiline){var b=a.length-2,e=this._iStartingFontSize;this.__refreshTextFont(e);for(var f=this._oText.getBounds();f.height+this._iOutline>this._iEffectiveHeight||f.width+this._iOutline>this._iEffectiveWidth;){if(c&&e<this._iMinTextSize){if(b--,this._oText.text=a.slice(0,b)+"...",this.__updateY(),this.__verticalAlign(),1==b)break}else if(e--,this.__refreshTextFont(e),
this.__updateY(),this.__verticalAlign(),e<this._iMinTextSize&&!c)break;f=this._oText.getBounds()}this._iFontSize=e;this.__updateY();this.__verticalAlign();this.__updateStroke()}else this.__autofitLight()}},__autofitLight:function(){this.__refreshTextFont(this._iStartingFontSize);var a=Math.floor(linearFunction(this._iEffectiveWidth,this._oText.getBounds().width+this._iOutline,0,this._iStartingFontSize,0));a>this._iStartingFontSize?a=this._iStartingFontSize:a<this._iMinTextSize&&(a=this._iMinTextSize);
this.__refreshTextFont(a);this._iFontSize=a;this.__updateY();this.__verticalAlign();this.__updateStroke()},__refreshTextFont:function(a){this._oText.font=a+"px "+this._szFont;this._oText.lineHeight=Math.round(a*this._fLineHeightFactor)},__verticalAlign:function(){if(this._bVerticalAlign){var a=this._oText.getBounds().height;this._oText.y-=(a-this._iHeight)/2+this._iPaddingV}},__updateY:function(){this._oText.y=this._iPaddingV;switch(this._oText.textBaseline){case "middle":this._oText.y+=this._oText.lineHeight/
2+(this._iFontSize*this._fLineHeightFactor-this._iFontSize)}},__updateStroke:function(){this._oStroke&&(this._oStroke.x=this._oText.x,this._oStroke.y=this._oText.y,this._oStroke.text=this._oText.text,this._oStroke.font=this._oText.font,this._oStroke.lineHeight=this._oText.lineHeight)},__updateOutline:function(){this._iOutline=this._oStroke&&this._oStroke.outline>this._oText.outline?this._oStroke.outline:this._oText.outline},__createText:function(a){this._bDebug&&(this._oDebugShape=new createjs.Shape,
this._oDebugShape.graphics.beginFill("rgba(255,130,0,0.5)").drawRect(0,0,this._iWidth,this._iHeight).moveTo(this._iPaddingH,this._iHeight-this._iPaddingV).lineTo(this._iWidth-this._iPaddingH,this._iHeight-this._iPaddingV).lineTo(this._iWidth-this._iPaddingH,this._iPaddingV).lineTo(this._iPaddingH,this._iPaddingV).closePath().beginFill("rgba(255,0,0,0.5)").drawRect(this._iPaddingH,this._iPaddingV,this._iEffectiveWidth,this._iEffectiveHeight),this._oContainer.addChild(this._oDebugShape));this._oText=
new createjs.Text(a,this._iFontSize+"px "+this._szFont,this._szColor);this._oText.textBaseline="middle";this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this._oText.textAlign=this._szAlign;this._oText.lineWidth=this._bMultiline?this._iWidth-2*this._iPaddingH:null;switch(this._szAlign){case "center":this._oText.x=this._iWidth/2;break;case "left":this._oText.x=this._iPaddingH;break;case "right":this._oText.x=this._iWidth-this._iPaddingH}this._oContainer.addChild(this._oText);
this.refreshText(a)},setStroke:function(a,c){this._oStroke||(this._oStroke=this._oText.clone(),this._oContainer.addChild(this._oStroke),this._oContainer.swapChildren(this._oStroke,this._oText));this.setStrokeColor(c?c:this._szStrokeColor);this.setStrokeSize(a?a:this._iStrokeSize)},setStrokeColor:function(a){this._szStrokeColor=a;this._oStroke&&(this._oStroke.color=this._szStrokeColor)},setStrokeSize:function(a){this._iStrokeSize=a;this._oStroke&&(this._oStroke.outline=this._iStrokeSize,this.__updateOutline(),
this.__autofit())},removeStroke:function(){this._oStroke&&(this._oContainer.removeChild(this._oStroke),this._oStroke=null,this.__updateOutline(),this.__autofit())},roll:function(a,c,b,e,f,l){c=null==c?1500:c;b=null==b?createjs.Ease.linear:b;if(this._oText){var g={score:parseInt(this._szMsg)};this._szMsg=a;var h=this._bFitText?function(){this._oText.text=Math.floor(g.score);this.__autofitLight()}:function(){this._oText.text=Math.floor(g.score)};this._oTweenRollText=createjs.Tween.get(g).to({score:a},
c,b);this._oTweenRollText.on("change",h,this);this._oTweenRollText.on("complete",function(){e&&e.apply(f,l);this.stopRolling()},this,!0)}},isRolling:function(){return null==this._oTweenRollText?!1:!0},stopRolling:function(){this.isRolling()&&(this._oTweenRollText.removeAllEventListeners(),this._oTweenRollText.paused=!0,this._oTweenRollText=null)},pauseRolling:function(){this.isRolling()&&(this._oTweenRollText.paused=!0)},resumeRolling:function(){this.isRolling()&&(this._oTweenRollText.paused=!1)},
setY:function(a){this._oContainer.y=a},setX:function(a){this._oContainer.x=a},setVerticalAlign:function(a){this._bVerticalAlign=a},setOutline:function(a){this._oText&&(this._oText.outline=a,this.__updateOutline())},setShadow:function(a,c,b,e){this._oText&&(this._oText.shadow=new createjs.Shadow(a,c,b,e))},setColor:function(a){this._szColor=a;this._oText.color=this._szColor},setAlpha:function(a){this._oContainer.alpha=a},setVisible:function(a){this._oContainer.visible=a},setFontSize:function(a){this._iFontSize=
this._iStartingFontSize=a;this.refreshText(this._szMsg)},removeTweens:function(){createjs.Tween.removeTweens(this._oContainer)},getText:function(){return this._oText},getTextWidth:function(){return this._oText.getBounds().width+this._iOutline},getTextHeight:function(){return this._oText.getBounds().height+this._iOutline},getMsg:function(){return this._szMsg},getX:function(){return this._oContainer.x},getY:function(){return this._oContainer.y},getHeight:function(){return this._iHeight},getWidth:function(){return this._iWidth},
getColor:function(){return this._szColor},getFontSize:function(){return this._iFontSize},unload:function(){this.stopRolling();this._oParentContainer.removeChild(this._oContainer)},refreshText:function(a){this._szMsg=a;""===this._szMsg&&(this._szMsg=" ");null===this._oText&&this.__createText(this._szMsg);this._oText.text=this._szMsg;this.__refreshTextFont(this._iStartingFontSize);this.__autofit()}};
function CTLText(a,c,b,e,f,l,g,h,d,k,n,p,r,m,t,w,y,u,q){u=void 0===u?11:u;q=void 0===q?!0:q;this._oParentContainer=a;this._oContainer=new createjs.Container;this._oContainer.x=c;this._oContainer.y=b;this._oParentContainer.addChild(this._oContainer);this._iOutline=0;this._iWidth=e;this._iHeight=f;this._bMultiline=w;this._iStartingFontSize=this._iFontSize=l;this._szAlign=g;this._szColor=h;this._szFont=d;this._iPaddingH=n;this._iPaddingV=p;this._iEffectiveWidth=this._iWidth-2*this._iPaddingH;this._iEffectiveHeight=
this._iHeight-2*this._iPaddingV;this._bVerticalAlign=t;this._bFitText=m;this._iMinTextSize=u;this._bDebug=y;this._bEllipsis=q;this._oDebugShape=null;this._fLineHeightFactor=k;this._oText=null;r&&this.__createText(r)}
function CTremble(a,c,b,e){var f,l,g,h,d,k,n;this._init=function(r,m,t,w){h=g=!1;k=0;this._calculateDuration();f=r.x;l=r.y;g||(g=!0,d=setInterval(function(){p._tremble()},t))};this._tremble=function(){if(h=!h){var r=.5>Math.random()?-e:e;var m=.5>Math.random()?-e:e;a.x+=r;a.y+=m}else a.x=f,a.y=l;k++;k>n&&(k=0,g=!1,s_oGame.endDamageTime(),a.x=f,a.y=l,0===c?d=setInterval(function(){p._tremble()},b):clearInterval(d))};this._calculateDuration=function(){n=c/b};this.stopTremble=function(){clearInterval(d)};
var p=this;this._init(a,c,b,e)}
function CGUIExpandible(a,c,b,e){var f,l,g,h,d,k,n,p,r;this._init=function(t,w,y,u){g=!0;d=[];n=new createjs.Container;n.x=t;n.y=w;u.addChild(n);p=new createjs.Container;n.addChild(p);r=new createjs.Container;n.addChild(r);h=!1;k=new CGfxButton(0,0,y,r);k.addEventListener(ON_MOUSE_UP,this._onMenu,this);l=f=130};this.unload=function(){k.unload();e.removeChild(n)};this.refreshPos=function(){n.x=a-s_iOffsetX;n.y=c+s_iOffsetY};this.reset=function(){h&&this._onMenu()};this.addButton=function(t){t=t.getButtonImage();
t.x=0;t.y=0;t.visible=0;p.addChildAt(t,0);d.push(t)};this._onMenu=function(){g&&((h=!h)?m._expand():m._collapse())};this._expand=function(){for(var t=0;t<d.length;t++)d[t].visible=!0,createjs.Tween.get(d[t],{override:!0}).wait(300*t/2).to({y:f+t*l},300,createjs.Ease.cubicOut)};this._collapse=function(){for(var t=0;t<d.length;t++){var w=d[d.length-1-t];createjs.Tween.get(w,{override:!0}).wait(300*t/2).to({y:0},300,createjs.Ease.cubicOut).call(function(y){y.visible=!1},[w])}};this.enable=function(){g=
!0;k.setActive(!0)};this.disable=function(){g=!1;k.setActive(!1)};this.isExpanded=function(){return h};var m=this;this._init(a,c,b,e)}
function CVector2(a,c){var b,e;this._init=function(f,l){b=f;e=l};this.add=function(f,l){b+=f;e+=l};this.addV=function(f){b+=f.getX();e+=f.getY()};this.scalarDivision=function(f){b/=f;e/=f};this.subV=function(f){b-=f.getX();e-=f.getY()};this.scalarProduct=function(f){b*=f;e*=f};this.invert=function(){b*=-1;e*=-1};this.dotProduct=function(f){return b*f.getX()+e*f.getY()};this.set=function(f,l){b=f;e=l};this.setV=function(f){b=f.getX();e=f.getY()};this.length=function(){return Math.sqrt(b*b+e*e)};this.length2=
function(){return b*b+e*e};this.normalize=function(){var f=this.length();0<f&&(b/=f,e/=f)};this.getNormalize=function(f){this.length();f.set(b,e);f.normalize()};this.rot90CCW=function(){var f=b;b=-e;e=f};this.rot90CW=function(){var f=b;b=e;e=-f};this.getRotCCW=function(f){f.set(b,e);f.rot90CCW()};this.getRotCW=function(f){f.set(b,e);f.rot90CW()};this.ceil=function(){b=Math.ceil(b);e=Math.ceil(e)};this.round=function(){b=Math.round(b);e=Math.round(e)};this.toString=function(){return"Vector2: "+b+", "+
e};this.print=function(){trace("Vector2: "+b+", "+e)};this.getX=function(){return b};this.getY=function(){return e};this._init(a,c)}
var CANVAS_WIDTH=1920,CANVAS_HEIGHT=1920,EDGEBOARD_X=0,EDGEBOARD_Y=0,FPS=60,FPS_DT=1/FPS,FPS_TIME=1E3/FPS,DISABLE_SOUND_MOBILE=!1,GAME_NAME="formula_rush",PRIMARY_FONT="alegreya_sans_scblack",SECONDARY_FONT="Digital",THIRD_FONT="ArialBold",PRIMARY_FONT_COLOUR="#000000",STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_PLAYER_PASSED_LAP=0,ON_PLAYER_COMPLETE_LAP=2,ON_PLAYER_COMPLETE_TRACK=3,ON_PLAYER_CHANGE_RANK=
4,ON_ENEMY_HIT=0,ON_ENEMY_DEAD=1,MODE_CLASSIC=0,MODE_ADVENTURE=1,MODE_SURVIVAL=2,STATE_GAME_START=0,STATE_GAME_RACE=1,STATE_GAME_END=2,STATE_RUNNER_RUN=0,STATE_RUNNER_ATTACK=1,STATE_RUNNER_DEATH=2,STATE_RUNNER_HURTED=3,OPPONENT_RUN_STATE_ACCELERATE="accelerate",OPPONENT_RUN_STATE_DECELERATE="decelerate",OPPONENT_RUN_STATE_BRAKE="brake",ATTACK_SIDE_LEFT="left",ATTACK_SIDE_RIGHT="right",KEY_UP=38,KEY_DOWN=40,KEY_RIGHT=39,KEY_LEFT=37,KEY_SPACE=32,KEY_UP_W=87,KEY_DOWN_S=83,KEY_RIGHT_D=68,KEY_LEFT_A=65,
ROTATE_LEFT=0,ROTATE_RIGHT=1,ROTATE_CENTER=2,NUM_WORLDS=1,NUM_TRACKS_PER_WORLD=3,OVERALL_DIFFICULTY,MIN_RANK_FOR_WIN=3,PLAYER_CAR_TYPE=0,TYPE_CAR_IN_GAME=[PLAYER_CAR_TYPE,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9],START_COUNTDOWN=3E3,FOV=100,CAMERA_HEIGHT=1E3,CAMERA_DEPTH=1/Math.tan(FOV/2*Math.PI/180),CAMERA_OFFSET_Z=-200,PLAYER_Z_FROMCAMERA=CAMERA_HEIGHT*CAMERA_DEPTH+CAMERA_OFFSET_Z,CAR_SIDEVIEW_OFFSET=.2,CAR_FARVIEW_OFFSET=2600,CAR_CURVEVIEW_OFFSET=.4,FRAMESPEED_ROTATION=100,MAX_ROTATION=10,HEIGHT_ROTATION_VIEW=
CANVAS_HEIGHT+300,WIDTH_ROTATION_VIEW=CANVAS_WIDTH+150,START_X_ROTATION_VIEW=(CANVAS_WIDTH-WIDTH_ROTATION_VIEW)/2,START_Y_ROTATION_VIEW=(CANVAS_HEIGHT-HEIGHT_ROTATION_VIEW)/2,PARALLAX_RATIO_X_1=2,PARALLAX_RATIO_X_2=2.4,PARALLAX_RATIO_Y_0=.004,PARALLAX_RATIO_Y_1=.005,PARALLAX_RATIO_Y_2=.006,PLAYER_MAX_SPEED,PLAYER_MIN_SPEED=3E3,PLAYER_ACCELERATION,PLAYER_DECELERATION,PLAYER_REAL_MAX_SPEED,PLAYER_LOW_SPEED_LIMIT=.3,PLAYER_LOW_SPEED_CORNERING_RATIO=.5,PLAYER_CORNERING_WEIGHT=25,PLAYER_CORNERING_INCREASE_RATIO=
4,PLAYER_COLLISION_FRONT_DISTANCE=0,PLAYER_RELATIVE_DAMAGE_X_DISTANCE=.18,PLAYER_DEPTH_SWAP=8E-4,PLAYER_SPEED_LOST_WHEN_COLLIDED=2E3,ENEMY_FLANKING_Z_OFFSET=400,GENERAL_X_SHIFTING_SPEED=.01,APPROACH_X_SHIFTING_SPEED=.005,CENTRIFUGAL_FORCE,PLAYER_COLLIDER_WIDTH=.1,PLAYER_MIN_SPEED_DAMAGE,TERRAIN_MAX_INERTIA=.03,TERRAIN_INCREASE_INERTIA=.005,TERRAIN_DECREASE_INERTIA=.002,TERRAIN_ADHERENCE=1,DRAW_DISTANCE=250,ROAD_WIDTH=2E3,NUM_LANES=4,SEGMENT_LENGTH=200,RUMBLE_LENGTH=3,TRACK_LENGTH,ROAD_BOUNDS=2,STARTING_GRID_X_OFFSET=
.4,STARTING_GRID_Z_OFFSET=6,FOG_DENSITY=5,DEPTH_DISTANCE_TO_FADE_ELEMENTS=3*PLAYER_DEPTH_SWAP,ELEMENT_TYPE_STATIC="static",ELEMENT_TYPE_ANIMATED="animated",ELEMENT_TYPE_LIGHT="light",ANIMATE_GROUP={QTY:{NONE:0,ALL:1,RANDOM:2},EFFECT:{NONE:0,SYNCRO:1,RANDOM:2,LIGHT_BROKEN:3,LIGHT_REGULAR:4,WATERFALL:5}},ROAD={TYPE:{STANDARD:0,CURVE_S:1,BUMPS:2,FINAL:3},LENGTH:{NONE:0,SHORT:25,MEDIUM:50,LONG:100,EXTRALONG:200},HILL:{NONE:0,LOW:20,MEDIUM:40,HIGH:60,VERYHIGH:80},CURVE:{NONE:0,EASY:2,MEDIUM:4,HARD:6,VERYHARD:8}},
AMBIENT={DISPOSITION:{PRECISE:0,DENSITY:1},SIDE:{CENTER:0,LEFT:-1,RIGHT:1,BOTH:2},TYPE:{NORMAL:0,FILL_TRACK:1,FILL_STRAIGHT:2,FILL_CURVE:3,FINISH:4,ANIMATION:5}},COLORS={LIGHT:{road:"#6B6B6B",grass:"#96a54b",rumble:"#555555",lane:"#CCCCCC"},DARK:{road:"#696969",grass:"#7e8b3e",rumble:"#BBBBBB"},START:{road:"white",grass:"white",rumble:"white"},FINISH:{road:"black",grass:"black",rumble:"black"}},SPRITES={BILLBOARD_0:{name:"billboard_0",physics:{center:152,width:290}},BILLBOARD_1:{name:"billboard_1",
physics:{center:98,width:50}},BILLBOARD_2:{name:"billboard_2",physics:{center:100,width:60}},BILLBOARD_3:{name:"billboard_3",physics:{center:152,width:290}},BILLBOARD_4:{name:"billboard_4",physics:{center:107,width:50}},BILLBOARD_5:{name:"billboard_5",physics:{center:107,width:50}},BILLBOARD_ARC_0:{name:"billboard_arc_0",physics:{base:30,width:880}},BILLBOARD_ARC_1:{name:"billboard_arc_1",physics:{base:30,width:880}},BILLBOARD_ARC_2:{name:"billboard_arc_2",physics:{base:30,width:880}},BILLBOARD_ARC_3:{name:"billboard_arc_3",
physics:{base:30,width:880}},BILLBOARD_ARC_4:{name:"billboard_arc_4",physics:{base:30,width:880}},FINISH:{name:"finish",physics:{base:100,width:880}},SECURITY_WALL:{name:"security_wall",physics:{width:700}},SCALE:.00375,ANIMATED:{SCALE:6.4E-4,PLAYER_ALIGN:800}},TYPE_CAR_COLOR=[["#ff352d","#ff352d"],["#f77d27","#075c81"],["#f6faff","#f6faff"],["#aab5c8","#ff3035"],["#3f9b91","#3f9b91"],["#530f5f","#530f5f"],["#530f5f","#bd1310"],["#5a86a4","#5a86a4"],["#295da5","#8effff"],["#cc365e","#ffffff"]],TYPE_CUP_COLOR=
[["#FFD700","#CD7F32"],["#C0C0C0","#555"],["#99622b","#5f3f20"],["#FFF","#000"]],HALF_CANVAS_WIDTH=CANVAS_WIDTH/2,HALF_CANVAS_HEIGHT=CANVAS_HEIGHT/2,ROAD_PER_HALF_CANVAS_WIDTH=HALF_CANVAS_WIDTH*ROAD_WIDTH,ROAD_PER_SCALE_PER_HALF_CANVAS_WIDTH=SPRITES.SCALE*ROAD_PER_HALF_CANVAS_WIDTH,ROAD_PER_SCALE_PER_HALF_CANVAS_WIDTH_ANIMATED=SPRITES.ANIMATED.SCALE*ROAD_PER_HALF_CANVAS_WIDTH,PLAYER_SPEED_CONVERSION_RATIO=PLAYER_REAL_MAX_SPEED/PLAYER_MAX_SPEED,ENABLE_FULLSCREEN,ENABLE_CHECK_ORIENTATION,SOUNDTRACK_VOLUME_IN_GAME=
.3,POINTS_PER_RANK,AD_SHOW_COUNTER;
function CPreloader(){var a,c,b,e,f,l,g,h;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("but_start","./sprites/but_start.png");s_oSpriteLibrary.loadSprites();h=new createjs.Container;s_oStage.addChild(h)};this.unload=function(){h.removeAllChildren();g.unload()};this._onImagesLoaded=function(){};
this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var d=s_oSpriteLibrary.getSprite("bg_menu");d=createBitmap(d);h.addChild(d);d=s_oSpriteLibrary.getSprite("progress_bar");e=createBitmap(d);e.x=CANVAS_WIDTH/2-d.width/2;e.y=CANVAS_HEIGHT/2+250;h.addChild(e);a=d.width;c=d.height;f=new createjs.Shape;f.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(e.x,e.y,1,c);h.addChild(f);e.mask=f;b=new createjs.Text("","30px "+PRIMARY_FONT,"#ffffe5");
b.x=CANVAS_WIDTH/2;b.y=e.y+80;b.textBaseline="alphabetic";b.textAlign="center";h.addChild(b);d=s_oSpriteLibrary.getSprite("but_start");g=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2,d,TEXT_PRELOADER_CONTINUE,"Arial","#000","bold 50",h);g.addEventListener(ON_MOUSE_UP,this._onButStartRelease,this);g.setVisible(!1);l=new createjs.Shape;l.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);h.addChild(l);createjs.Tween.get(l).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(l);
h.removeChild(l)})};this._onButStartRelease=function(){s_oMain._onRemovePreloader()};this.refreshLoader=function(d){b.text=d+"%";100===d&&(s_oMain._onRemovePreloader(),b.visible=!1,e.visible=!1);f.graphics.clear();d=Math.floor(d*a/100);f.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(e.x,e.y,d,c)};this._init()}
function CMain(a){var c,b=0,e=0,f=STATE_LOADING,l,g;this.initContainer=function(){s_oCanvas=document.getElementById("canvas");s_oStage=new createjs.Stage(s_oCanvas);s_oStage.preventSelection=!1;createjs.Touch.enable(s_oStage);s_bMobile=isMobile();!1===s_bMobile&&s_oStage.enableMouseOver(20);s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",this._update);createjs.Ticker.framerate=FPS;navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;
l=new CPreloader;s_oLocalStorage=new CLocalStorage(GAME_NAME)};this.preloaderReady=function(){this._loadImages();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds();c=!0};this.soundLoaded=function(){b++;l.refreshLoader(Math.floor(b/e*100))};this._initSounds=function(){Howler.mute(!s_bAudioActive);s_aSoundsInfo=[];s_aSoundsInfo.push({path:"./sounds/",filename:"menu_soundtrack",loop:!0,volume:1,ingamename:"menu_soundtrack"});s_aSoundsInfo.push({path:"./sounds/",filename:"game_soundtrack",
loop:!0,volume:1,ingamename:"game_soundtrack"});s_aSoundsInfo.push({path:"./sounds/",filename:"press_button",loop:!1,volume:1,ingamename:"click"});s_aSoundsInfo.push({path:"./sounds/",filename:"1",loop:!1,volume:1,ingamename:"1"});s_aSoundsInfo.push({path:"./sounds/",filename:"2",loop:!1,volume:1,ingamename:"2"});s_aSoundsInfo.push({path:"./sounds/",filename:"3",loop:!1,volume:1,ingamename:"3"});s_aSoundsInfo.push({path:"./sounds/",filename:"go",loop:!1,volume:1,ingamename:"go"});s_aSoundsInfo.push({path:"./sounds/",
filename:"arrive_lose",loop:!1,volume:1,ingamename:"arrive_lose"});s_aSoundsInfo.push({path:"./sounds/",filename:"arrive_win",loop:!1,volume:1,ingamename:"arrive_win"});s_aSoundsInfo.push({path:"./sounds/",filename:"sprint_start",loop:!1,volume:1,ingamename:"sprint_start"});s_aSoundsInfo.push({path:"./sounds/",filename:"crash",loop:!1,volume:1,ingamename:"crash"});s_aSoundsInfo.push({path:"./sounds/",filename:"brake",loop:!1,volume:1,ingamename:"brake"});s_aSoundsInfo.push({path:"./sounds/",filename:"engine",
loop:!0,volume:1,ingamename:"engine"});s_aSoundsInfo.push({path:"./sounds/",filename:"engine_stall",loop:!0,volume:1,ingamename:"engine_stall"});s_aSoundsInfo.push({path:"./sounds/",filename:"engine_reverse",loop:!0,volume:1,ingamename:"engine_reverse"});e+=s_aSoundsInfo.length;s_aSounds=[];for(var d=0;d<s_aSoundsInfo.length;d++)this.tryToLoadSound(s_aSoundsInfo[d],!1)};this.tryToLoadSound=function(d,k){setTimeout(function(){s_aSounds[d.ingamename]=new Howl({src:[d.path+d.filename+".mp3"],autoplay:!1,
preload:!0,loop:d.loop,volume:d.volume,onload:s_oMain.soundLoaded,onloaderror:function(n,p){for(var r=0;r<s_aSoundsInfo.length;r++)if(n===s_aSounds[s_aSoundsInfo[r].ingamename]._sounds[0]._id){s_oMain.tryToLoadSound(s_aSoundsInfo[r],!0);break}},onplayerror:function(n){for(var p=0;p<s_aSoundsInfo.length;p++)if(n===s_aSounds[s_aSoundsInfo[p].ingamename]._sounds[0]._id){s_aSounds[s_aSoundsInfo[p].ingamename].once("unlock",function(){s_aSounds[s_aSoundsInfo[p].ingamename].play();"soundtrack"===s_aSoundsInfo[p].ingamename&&
null!==s_oGame&&setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)});break}}})},k?200:0)};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("keys","./sprites/keys.png");s_oSpriteLibrary.addSprite("star","./sprites/star.png");s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png");s_oSpriteLibrary.addSprite("but_credits","./sprites/but_credits.png");s_oSpriteLibrary.addSprite("ctl_logo",
"./sprites/ctl_logo.png");s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png");s_oSpriteLibrary.addSprite("but_yes","./sprites/but_yes.png");s_oSpriteLibrary.addSprite("but_delete_saving","./sprites/but_delete_saving.png");s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("logo_menu","./sprites/logo_menu.png");s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png");s_oSpriteLibrary.addSprite("but_settings","./sprites/but_settings.png");
for(var d=0;d<NUM_WORLDS;d++)s_oSpriteLibrary.addSprite("w"+d+"_patch","./sprites/backgrounds/world_"+d+"/patch.png"),s_oSpriteLibrary.addSprite("w"+d+"_bg0","./sprites/backgrounds/world_"+d+"/bg0.png"),s_oSpriteLibrary.addSprite("w"+d+"_bg1","./sprites/backgrounds/world_"+d+"/bg1.png"),s_oSpriteLibrary.addSprite("w"+d+"_bg2","./sprites/backgrounds/world_"+d+"/bg2.png");s_oSpriteLibrary.addSprite("key_up","./sprites/key_up.png");s_oSpriteLibrary.addSprite("key_down","./sprites/key_down.png");s_oSpriteLibrary.addSprite("key_left",
"./sprites/key_left.png");s_oSpriteLibrary.addSprite("key_right","./sprites/key_right.png");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");s_oSpriteLibrary.addSprite("but_next","./sprites/but_next.png");s_oSpriteLibrary.addSprite("tachometer","./sprites/tachometer.png");for(d=0;30>d;d++)s_oSpriteLibrary.addSprite("hit_contact_"+d,"./sprites/hit_contact/hit_contact_"+
d+".png");for(d=0;5>d;d++)s_oSpriteLibrary.addSprite("billboard_"+d,"./sprites/elements/day/billboard_"+d+".png"),s_oSpriteLibrary.addSprite("billboard_arc_"+d,"./sprites/elements/day/billboard_arc_"+d+".png");s_oSpriteLibrary.addSprite("billboard_5","./sprites/elements/day/billboard_5.png");s_oSpriteLibrary.addSprite("finish","./sprites/elements/day/finish.png");s_oSpriteLibrary.addSprite("security_wall","./sprites/elements/day/security_wall.png");for(d=0;d<s_aFolderName.length;d++)for(var k=0;5>
k;k++)s_oSpriteLibrary.addSprite(s_aFileName[d]+"_"+k,"./sprites/cars/"+s_aFolderName[d]+"/"+s_aFileName[d]+"_"+k+".png");for(d=0;5>d;d++)s_oSpriteLibrary.addSprite("car_shadow_"+d,"./sprites/cars/car_shadow/car_shadow_"+d+".png");s_oSpriteLibrary.addSprite("map_panel","./sprites/map_panel.png");s_oSpriteLibrary.addSprite("end_icon_map","./sprites/end_icon_map.png");s_oSpriteLibrary.addSprite("lap_panel","./sprites/lap_panel.png");s_oSpriteLibrary.addSprite("gold_cup","./sprites/gold_cup.png");s_oSpriteLibrary.addSprite("silver_cup",
"./sprites/silver_cup.png");s_oSpriteLibrary.addSprite("bronze_cup","./sprites/bronze_cup.png");e+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites(5)};this._onImagesLoaded=function(){b++;l.refreshLoader(Math.floor(b/e*100))};this._onRemovePreloader=function(){l.unload();playSound("menu_soundtrack",1,!0);new CAnimSettings;this.gotoMenu()};this._onAllImagesLoaded=function(){};this.onAllPreloaderImagesLoaded=function(){this._loadImages()};this.gotoMenu=function(){new CMenu;f=STATE_MENU};
this.gotoModeMenu=function(){new CModeMenu;f=STATE_MENU};this.gotoSelectCharacterMenu=function(){new CSelectCharacterMenu;f=STATE_MENU};this.gotoWorldMenu=function(){new CWorldMenu;f=STATE_MENU};this.gotoGame=function(d){s_oGame=g=new CGameRace(h,d);f=STATE_GAME};this.gotoHelp=function(){new CHelp;f=STATE_HELP};this.stopUpdate=function(){c=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");Howler.mute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();c=!0;createjs.Ticker.paused=
!1;$("#block_game").css("display","none");s_bAudioActive&&Howler.mute(!1)};this._update=function(d){if(!1!==c){var k=(new Date).getTime();s_iTimeElaps=k-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=k;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);s_oStage.update(d);f===STATE_GAME&&g.update()}};s_oMain=this;var h=a;ENABLE_FULLSCREEN=a.fullscreen;ENABLE_CHECK_ORIENTATION=a.check_orientation;s_bAudioActive=a.audio_enable_on_startup;PLAYER_MAX_SPEED=a.player_max_speed;
PLAYER_ACCELERATION=PLAYER_MAX_SPEED/5;PLAYER_BRAKING_RATE=PLAYER_MAX_SPEED/2;PLAYER_DECELERATION=PLAYER_MAX_SPEED/14;PLAYER_MIN_SPEED_DAMAGE=PLAYER_MAX_SPEED/3;PLAYER_REAL_MAX_SPEED=a.player_maxspeed_indicator;PLAYER_SPEED_CONVERSION_RATIO=PLAYER_REAL_MAX_SPEED/PLAYER_MAX_SPEED;CENTRIFUGAL_FORCE=a.player_centrifugal_force;POINTS_PER_RANK=a.points_per_rank;OVERALL_DIFFICULTY=a.overall_difficulty;this.initContainer()}
var s_bMobile,s_bAudioActive=!0,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=1/FPS_DT,s_bFullscreen=!1,s_oDrawLayer,s_oStage,s_oMain,s_oGame=null,s_oSpriteLibrary,s_oSoundTrack,s_oCanvas,s_oLocalStorage,s_aSounds=[],s_aSoundsInfo,s_aFolderName="car_0 car_1 car_2 car_3 car_4 car_5 car_6 car_7 car_8 car_9".split(" "),s_aFileName="car_0 car_1 car_2 car_3 car_4 car_5 car_6 car_7 car_8 car_9".split(" "),s_iCharacterSelected=0;
function CCreditsPanel(){var a,c,b,e,f;this._init=function(){c=new createjs.Shape;c.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);c.alpha=0;c.on("click",function(){});s_oStage.addChild(c);(new createjs.Tween.get(c)).to({alpha:.7},500);b=new createjs.Container;s_oStage.addChild(b);var l=s_oSpriteLibrary.getSprite("msg_box"),g=createBitmap(l);g.regX=l.width/2;g.regY=l.height/2;b.addChild(g);b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT+l.height/2+50;a=b.y;(new createjs.Tween.get(b)).to({y:CANVAS_HEIGHT/
2-40},500,createjs.Ease.quartIn);new CTLText(b,-250,-l.height/2+110-25,500,50,40,"center","#fff",PRIMARY_FONT,1,2,2,TEXT_DEVELOPED,!0,!0,!1,!1);new CTLText(b,-250,171,500,50,40,"center","#fff",PRIMARY_FONT,1,2,2,"www.codethislab.com",!0,!0,!1,!1);l=s_oSpriteLibrary.getSprite("ctl_logo");f=createBitmap(l);f.on("click",this._onLogoButRelease);f.regX=l.width/2;f.regY=l.height/2;b.addChild(f);l=s_oSpriteLibrary.getSprite("but_exit");e=new CGfxButton(300,-180,l,b);e.addEventListener(ON_MOUSE_UP,this.unload,
this)};this.unload=function(){e.setClickable(!1);(new createjs.Tween.get(c)).to({alpha:0},500);(new createjs.Tween.get(b)).to({y:a},400,createjs.Ease.backIn).call(function(){s_oStage.removeChild(c);s_oStage.removeChild(b);e.unload()});c.removeAllEventListeners();f.removeAllEventListeners()};this._onLogoButRelease=function(){window.open("http://www.codethislab.com/index.php?&l=en")};this._init()}
function CMenu(){var a,c,b,e,f,l,g,h,d,k,n,p,r,m,t,w,y,u,q=null,E=null;this._init=function(){var z=s_oSpriteLibrary.getSprite("bg_menu");d=createBitmap(z);d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT/2;d.regX=z.width/2;d.regY=z.height/2;s_oStage.addChild(d);z=s_oSpriteLibrary.getSprite("logo_menu");u=createBitmap(z);u.regX=z.width/2;u.regY=z.height/2;u.x=CANVAS_WIDTH/2;u.y=CANVAS_HEIGHT/2-350;u.scale=.69;s_oStage.addChild(u);z=s_oSpriteLibrary.getSprite("but_play");k=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/
2+500,z,s_oStage);k.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this);k.pulseAnimation();y=new createjs.Container;y.x=k.getX();y.y=k.getY()+210;s_oStage.addChild(y);z=s_oSpriteLibrary.getSprite("star");var A=createBitmap(z);A.regX=z.width/2;A.regY=z.height/2;y.addChild(A);for(A=z=0;A<s_aLevelScore.length;A++)z+=s_aLevelScore[A];w=new CTLText(y,50,-50,250,100,80,"left","#fff",PRIMARY_FONT,1,0,0,z+"",!0,!0,!1,!1);w.setStroke(10,"#000");y.x=k.getX()-w.getTextWidth()/2;z=s_oSpriteLibrary.getSprite("but_credits");
f=z.width/2+10;l=z.height/2+10;r=new CGfxButton(f,l,z,s_oStage);r.addEventListener(ON_MOUSE_UP,this._onCreditsBut,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)z=s_oSpriteLibrary.getSprite("audio_icon"),g=CANVAS_WIDTH-z.height/2-10,h=z.height/2+10,p=new CToggle(g,h,z,s_bAudioActive,s_oStage),p.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);z=s_oSpriteLibrary.getSprite("but_delete_saving");a=CANVAS_WIDTH-z.width/2-12;c=CANVAS_HEIGHT-z.height/2-16;t=new CGfxButton(a,c,z,s_oStage);t.addEventListener(ON_MOUSE_UP,
this._onDeleteBut,this);s_oLocalStorage.isDirty()||t.setVisible(!1);z=window.document;A=z.documentElement;q=A.requestFullscreen||A.mozRequestFullScreen||A.webkitRequestFullScreen||A.msRequestFullscreen;E=z.exitFullscreen||z.mozCancelFullScreen||z.webkitExitFullscreen||z.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(q=!1);q&&screenfull.isEnabled&&(z=s_oSpriteLibrary.getSprite("but_fullscreen"),b=f+z.width/2+10,e=z.height/2+10,m=new CToggle(b,e,z,s_bFullscreen,s_oStage),m.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,
this));n=new createjs.Shape;n.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(n);createjs.Tween.get(n).to({alpha:0},1E3).call(function(){n.visible=!1});this.refreshButtonPos();s_oLocalStorage.isUsed()||new CMsgBox(TEXT_IOS_PRIVATE)};this.unload=function(){k.unload();r.unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)p.unload(),p=null;q&&screenfull.isEnabled&&m.unload();s_oMenu=null;s_oStage.removeAllChildren()};this.refreshButtonPos=function(){s_bLandscape?
(k.setPosition(CANVAS_WIDTH/2,CANVAS_HEIGHT-150-s_iOffsetY),y.x=s_iOffsetX+60,y.y=CANVAS_HEIGHT-60-s_iOffsetY,u.y=CANVAS_HEIGHT/2-310):(k.setPosition(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+500),y.y=k.getY()+210,y.x=k.getX()-w.getTextWidth()/2,u.y=CANVAS_HEIGHT/2-350);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||p.setPosition(g-s_iOffsetX,s_iOffsetY+h);q&&screenfull.isEnabled&&m.setPosition(b+s_iOffsetX,e+s_iOffsetY);r.setPosition(f+s_iOffsetX,s_iOffsetY+l);t.setPosition(a-s_iOffsetX,c-s_iOffsetY)};this.resetFullscreenBut=
function(){q&&screenfull.isEnabled&&m.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?E.call(window.document):q.call(window.document.documentElement);sizeHandler()};this._onCreditsBut=function(){new CCreditsPanel};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onDeleteBut=function(){(new CAreYouSurePanel(s_oMenu.deleteSavings)).changeMessage(TEXT_SAVE_REMOVE,24);w.refreshText(0)};this.deleteSavings=function(){s_oLocalStorage.deleteData();
s_oLocalStorage.resetData();t.unload()};this._onButPlayRelease=function(){s_oMenu.unload();$(s_oMain).trigger("start_session");s_oMain.gotoGame(0)};s_oMenu=this;this._init()}
var s_oMenu=null,CGameBase=function(a,c){this._bStartGame;this._bDamaged;this._bCollision;this._iStartCountDown;this._iTimeElaps;this._iLevel;this._iScore;this._iGameState;this._iCurRotationScreenDir;this._iCurFrameRotation;this._iCurRotation;this._aSegments;this._oInterface;this._oEndPanel=null;this._oParent;this._oPrevSegment;this._oPlayer;this._oRoad;this._oGrassDrawingLevel;this._oRoadDrawingLevel;this._oRumbleDrawingLevel;this._oLaneDrawingLevel;this._oElementContainer;this._oHorizon;this._iHorizonOffset;
this._aCars;this._aEnemy;this._oLevelBuilder;s_oGame=this;this._init(c)};
CGameBase.prototype._init=function(a){this._iLevel=a;this._aSegments=[];this._oGameContainer=new createjs.Container;this._oGameContainer.x=CANVAS_WIDTH/2;this._oGameContainer.y=CANVAS_HEIGHT;this._oGameContainer.regX=CANVAS_WIDTH/2;this._oGameContainer.regY=CANVAS_HEIGHT;s_oStage.addChild(this._oGameContainer);this._oHorizon=new CHorizon(this._iLevel,this._oGameContainer);this._oRoadDrawingContainer=new createjs.Container;this._oGameContainer.addChild(this._oRoadDrawingContainer);this._oGrassDrawingLevel=
new createjs.Shape;this._oRoadDrawingContainer.addChild(this._oGrassDrawingLevel);this._oRoadDrawingLevel=new createjs.Shape;this._oRoadDrawingContainer.addChild(this._oRoadDrawingLevel);this._oRumbleDrawingLevel=new createjs.Shape;this._oRoadDrawingContainer.addChild(this._oRumbleDrawingLevel);this._oLaneDrawingLevel=new createjs.Shape;this._oRoadDrawingContainer.addChild(this._oLaneDrawingLevel);this._oRumbleStrokeLevel=new createjs.Shape;this._oRoadDrawingContainer.addChild(this._oRumbleStrokeLevel);
this._oElementContainer=new createjs.Container;this._oGameContainer.addChild(this._oElementContainer);this._oRoad=new CRoad(this._oRoadDrawingLevel,this._oElementContainer,this._iLevel,this._oRumbleDrawingLevel,this._oGrassDrawingLevel,this._oLaneDrawingLevel,this._oRumbleStrokeLevel);this._oPlayer=new CPlayer(CANVAS_WIDTH/2,CANVAS_HEIGHT-180,this._oElementContainer);this._oPlayer.addEventListener(ON_PLAYER_PASSED_LAP,this.playerLapPassed,this);this._aSegments=this._oRoad.getSegments();TRACK_LENGTH=
this._oRoad.getTrackLength();this._oInterface=new CInterface;var c=this._oPlayer.getCursor();this._oInterface.addMiniMapCursor(c,this._oPlayer);this._aCars=[];this._aEnemy=[];this._oLevelBuilder=new CLevelBuilder(this._oPlayer,this._aCars,this._aEnemy,this._oElementContainer,a);this.resetParams();this.refreshButtonPos()};CGameBase.prototype.refreshButtonPos=function(){this._oInterface.refreshButtonPos();this._oGameContainer.y=CANVAS_HEIGHT-.5*s_iOffsetY};
CGameBase.prototype.getWorldCameraPos=function(){var a=this._oPlayer.getPosition().z,c=this._aSegments[this.findSegment(a).index];return{x:Util.interpolate(c.p1.world.x,c.p2.world.x,(a-c.p1.world.z)/SEGMENT_LENGTH)+this._iHorizonOffset,y:0}};CGameBase.prototype.playerLapPassed=function(){this._iHorizonOffset+=this._aSegments[this._aSegments.length-1].p1.world.x};function _onKeyboardUp(a){a.preventDefault();s_oGame.onKeyUp(a.keyCode)}
function _onKeyboardDown(a){a||(a=window.event);a.preventDefault();s_oGame.onKeyDown(a.keyCode)}CGameBase.prototype.onKeyUp=function(a){if(this._bStartGame)switch(a){case KEY_LEFT_A:case KEY_LEFT:this._oPlayer.stopLeft();break;case KEY_UP_W:case KEY_UP:this._oPlayer.stopAccelerate();break;case KEY_RIGHT_D:case KEY_RIGHT:this._oPlayer.stopRight();break;case KEY_DOWN_S:case KEY_DOWN:this._oPlayer.stopBrake()}};
CGameBase.prototype.onKeyDown=function(a){if(this._bStartGame)switch(a){case KEY_LEFT_A:case KEY_LEFT:this._oPlayer.moveLeft();break;case KEY_UP_W:case KEY_UP:this._oPlayer.moveAccelerate();break;case KEY_RIGHT_D:case KEY_RIGHT:this._oPlayer.moveRight();break;case KEY_DOWN_S:case KEY_DOWN:this._oPlayer.moveBrake()}};
CGameBase.prototype.resetParams=function(){this._bStartGame=!1;stopSound(s_aSounds.game_soundtrack);if(0===this._iLevel)new CHelpPanel;else{this._bStartGame=!0;stopSound(s_aSounds.menu_soundtrack);playSound("game_soundtrack",SOUNDTRACK_VOLUME_IN_GAME,!0);$(s_oMain).trigger("start_level",this._iLevel);var a=new createjs.Shape;a.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.alpha=1;s_oStage.addChild(a);(new createjs.Tween.get(a)).to({alpha:0},750).call(function(){s_oStage.removeChild(a)})}this._iGameState=
STATE_GAME_START;this._iScore=0;this._iTimeElaps=LEVEL_INFO[this._iLevel].time;this._iStartCountDown=START_COUNTDOWN;this._iHorizonOffset=this._iCurRotation=this._iCurFrameRotation=this._iCurRotationScreenDir=0;this._oHorizon.restart();this._oInterface.setLevelInfo(this._iLevel%NUM_TRACKS_PER_WORLD);s_bMobile||(document.onkeydown=_onKeyboardDown,document.onkeyup=_onKeyboardUp);this._oPrevSegment=this._oPlayer.getPlayerSegment();this._oPlayer.reset()};
CGameBase.prototype.restartGame=function(){$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("restart_level",this._iLevel);this.resetParams()};CGameBase.prototype.unload=function(){this._oInterface.unload();null!==this._oEndPanel&&this._oEndPanel.unload();stopSound(s_aSounds.menu_soundtrack);stopSound(s_aSounds.game_soundtrack);stopSound(s_aSounds.engine);stopSound(s_aSounds.brake);stopSound(s_aSounds.engine_reverse);stopSound(s_aSounds.engine_stall);createjs.Tween.removeAllTweens();s_oStage.removeAllChildren()};
CGameBase.prototype.checkDamage=function(){this._oPlayer.getCurSpeed()>PLAYER_MIN_SPEED_DAMAGE&&this.setPlayerDamage(0,null)};CGameBase.prototype.endDamageTime=function(){this._bDamaged=!1};CGameBase.prototype._countDown=function(){this._iStartCountDown-=s_iTimeElaps;this._oInterface.refreshCountdown(this._iStartCountDown);0>=this._iStartCountDown&&(this._iStartCountDown=0,this._iGameState=STATE_GAME_RACE,this._oInterface.countDownGo())};
CGameBase.prototype.nextLevel=function(){s_oGame._iLevel++;s_oGame._iLevel<NUM_TRACKS_PER_WORLD*NUM_WORLDS?(s_oGame.unload(),s_oGame._init(s_oGame._iLevel),s_oGame._startGame()):s_oGame.gameOver()};CGameBase.prototype.trackLose=function(){this._iGameState=STATE_GAME_END;s_oGame.stopPlayer();$(s_oMain).trigger("end_level",this._iLevel);$(s_oMain).trigger("show_interlevel_ad");(new CLosePanel(s_oSpriteLibrary.getSprite("msg_box"))).show(this._iScore)};
CGameBase.prototype.stopPlayer=function(){this._oPlayer.stopAll();s_bMobile||(document.onkeydown=null,document.onkeyup=null)};CGameBase.prototype.onExit=function(){s_oGame.unload();$(s_oMain).trigger("end_session");playSound("menu_soundtrack",1,!0);s_oMain.gotoMenu()};CGameBase.prototype._onExitHelp=function(){this._bStartGame=!0;stopSound(s_aSounds.menu_soundtrack);playSound("game_soundtrack",SOUNDTRACK_VOLUME_IN_GAME,!0);$(s_oMain).trigger("start_level",1)};
CGameBase.prototype.gameOver=function(){this._oEndPanel=new CEndPanel(s_oSpriteLibrary.getSprite("msg_box"));this._oEndPanel.show(this._iScore)};CGameBase.prototype.setPause=function(){this._bStartGame=!1;this._oPlayer.stopAll()};CGameBase.prototype.setResume=function(){s_oGame._bStartGame=!0};
CGameBase.prototype.update=function(){var a=1/s_iCurFps;switch(this._iGameState){case STATE_GAME_START:this._bStartGame&&this._countDown();break;case STATE_GAME_RACE:if(!this._bStartGame)return;this._oPlayer.update(a);this.updateRace(a);break;case STATE_GAME_END:this._oPlayer.update(a),this._oPlayer.autoPilot(),this.updateOpponents(a)}this._oInterface.refreshSpeed(this._oPlayer.getCurSpeed()*PLAYER_SPEED_CONVERSION_RATIO);this._oInterface.refreshMiniMap(this._oPlayer.getPlayerSegment().index);this._oRoad.update(this._oPlayer.getPosition());
this._oHorizon.move(this.getWorldCameraPos());this._bCollision=!1;this._checkCollisions();this._oPrevSegment=this._oPlayer.getPlayerSegment()};CGameBase.prototype._checkCollisions=function(){var a=this._oPlayer.getPlayerSegment().index;a+=PLAYER_COLLISION_FRONT_DISTANCE;for(var c=[],b=this._oPrevSegment.index;b<=a;b++)c.push(this._aSegments[b%this._aSegments.length]);for(b=0;b<c.length;b++)this._checkEnemiesCollision(c[b])};
CGameBase.prototype._checkAmbientCollision=function(a){if(this._oPlayer.isOutOfRoad())for(var c=0;c<a.elements.length;c++){var b=a.elements[c].source;if(Util.overlap(this._oPlayer.getPosition().x,this._oPlayer.getPlayerWidth(),b.getCollisor().center,b.getCollisor().width,1)){this.checkDamage();this._oPlayer.setCurSpeed(PLAYER_ACCELERATION);a=this._oPlayer.getPlayerSegment();this._oPlayer.setPosition(Util.increase(a.p1.world.z,-PLAYER_Z_FROMCAMERA,TRACK_LENGTH));this._bCollision=!0;this._oPlayer.stopEngineSound();
break}}};
CGameBase.prototype._checkEnemiesCollision=function(a){for(var c,b,e=0;e<a.enemy.length;e++){c=a.enemy[e];b=c.getSpriteBounds().width*SPRITES.ANIMATED.SCALE;b=Util.overlap(this._oPlayer.getPosition().x,this._oPlayer.getPlayerWidth(),c.getOffset(),b,.6);var f=c.getState()!==STATE_RUNNER_DEATH&&c.getState()!==STATE_RUNNER_HURTED;if(b&&f){this._oPlayer.getCurSpeed()-c.getSpeed()>PLAYER_MIN_SPEED_DAMAGE?(this.checkDamage(),this._oPlayer.setCurSpeed(c.getSpeed()*(c.getSpeed()/this._oPlayer.getCurSpeed())),this._bCollision=
!0,this._oPlayer.stopEngineSound(),this.setEnemyDamage(c,null)):(a=this.getRelativeEnemyPosToPlayer(c),e=this.getRelativeEnemyZPosToPlayer(c),c.lateralCollision(a),this._oPlayer.lateralCollision(a,c),this.setPlayerDamage(0,a,e));break}}};CGameBase.prototype.getRelativeEnemyPosToPlayer=function(a){var c=this._oPlayer.getPosition().x;return a.getOffset()-c};CGameBase.prototype.getRelativeEnemyZPosToPlayer=function(a){var c=this._oPlayer.getPosition().z;return a.getZ()-c};
CGameBase.prototype.setPlayerDamage=function(a,c,b){this._bDamaged||(this._bDamaged=!0,this._oPlayer.damageAnim(c,b),new CTremble(s_oStage,250,20,5))};CGameBase.prototype.playerCollide=function(){return this._bCollision};CGameBase.prototype.rumbleCondition=function(a){return 1<a.curve||-1>a.curve};CGameBase.prototype.findSegment=function(a){return this._oRoad.findSegment(a)};CGameBase.prototype.getSegments=function(){return this._aSegments};
CGameBase.prototype.getValidSegment=function(a){a%=this._aSegments.length;return 0<a?this._aSegments[a]:this._aSegments[this._aSegments.length+a-1]};CGameBase.prototype.getPlayer=function(){return this._oPlayer};
function CInterface(){var a,c,b,e,f,l,g,h,d,k,n,p,r,m,t,w,y,u,q,E,z,A,C,K,B,O,S=null,V=null,R,W,X,Z;this._init=function(){var x=[],H=new createjs.Container;s_oStage.addChild(H);var I=s_oSpriteLibrary.getSprite("but_exit");w=new CGfxButton(0,0,I,H);w.addEventListener(ON_MOUSE_UP,this._onExit,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)I=s_oSpriteLibrary.getSprite("audio_icon"),t=new CToggle(0,0,I,s_bAudioActive),t.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);I=window.document;var v=
I.documentElement;S=v.requestFullscreen||v.mozRequestFullScreen||v.webkitRequestFullScreen||v.msRequestFullscreen;V=I.exitFullscreen||I.mozCancelFullScreen||I.webkitExitFullscreen||I.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(S=!1);S&&screenfull.isEnabled&&(I=s_oSpriteLibrary.getSprite("but_fullscreen"),K=new CToggle(0,0,I,s_bFullscreen,H),K.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this),x.push(K));I=s_oSpriteLibrary.getSprite("but_settings");f=CANVAS_WIDTH-I.width/2-10;l=I.height/2+
10;B=new CGUIExpandible(f,l,I,H);B.addButton(w);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||B.addButton(t);S&&screenfull.isEnabled&&B.addButton(K);y=new CTachometer(206,CANVAS_HEIGHT-12,H);b=CANVAS_WIDTH-162;e=CANVAS_HEIGHT-226;R=new CMiniMap(b,e,H);R.setPath(s_oGame.getSegments());W=new CLapIndicator(CANVAS_WIDTH/2,10,s_oStage);a=20;c=0;X=new createjs.Container;X.x=a;X.y=c;H.addChild(X);Z=new CRankIndicator(150,70,X,150);u=new createjs.Text(""," 300px "+PRIMARY_FONT,"#000");u.x=CANVAS_WIDTH/2;u.y=
CANVAS_HEIGHT/2;u.textAlign="center";u.textBaseline="middle";u.lineWidth=200;u.outline=20;H.addChild(u);q=new createjs.Text(""," 300px "+PRIMARY_FONT,"#fff");q.x=CANVAS_WIDTH/2;q.y=CANVAS_HEIGHT/2;q.textAlign="center";q.textBaseline="middle";q.lineWidth=200;H.addChild(q);s_bMobile&&(x=CANVAS_HEIGHT-300,I=s_oSpriteLibrary.getSprite("key_up"),r=CANVAS_WIDTH-180+I.width/2,m=x,E=new CGfxButton(r,m,I,H),E.addEventListenerWithParams(ON_MOUSE_UP,s_oGame.onKeyUp,s_oGame,KEY_UP),E.addEventListenerWithParams(ON_MOUSE_DOWN,
s_oGame.onKeyDown,s_oGame,KEY_UP),I=s_oSpriteLibrary.getSprite("key_down"),n=CANVAS_WIDTH-180-I.width/2,p=x,z=new CGfxButton(n,p,I,H),z.addEventListenerWithParams(ON_MOUSE_UP,s_oGame.onKeyUp,s_oGame,KEY_DOWN),z.addEventListenerWithParams(ON_MOUSE_DOWN,s_oGame.onKeyDown,s_oGame,KEY_DOWN),I=s_oSpriteLibrary.getSprite("key_left"),d=180-I.width/2,k=x,A=new CGfxButton(d,k,I,H),A.addEventListenerWithParams(ON_MOUSE_UP,s_oGame.onKeyUp,s_oGame,KEY_LEFT),A.addEventListenerWithParams(ON_MOUSE_DOWN,s_oGame.onKeyDown,
s_oGame,KEY_LEFT),I=s_oSpriteLibrary.getSprite("key_right"),g=180+I.width/2,h=x,C=new CGfxButton(g,h,I,H),C.addEventListenerWithParams(ON_MOUSE_UP,s_oGame.onKeyUp,s_oGame,KEY_RIGHT),C.addEventListenerWithParams(ON_MOUSE_DOWN,s_oGame.onKeyDown,s_oGame,KEY_RIGHT));O=[];for(H=0;3>=H;H++)O[H]=!1;this.refreshButtonPos()};this.unload=function(){B.unload();s_oInterface=null;s_bMobile&&(E.unload(),z.unload(),A.unload(),C.unload())};this.refreshButtonPos=function(){B.refreshPos();s_bMobile&&(E.setPosition(r-
s_iOffsetX,m-s_iOffsetY),z.setPosition(n-s_iOffsetX,p-s_iOffsetY),A.setPosition(d+s_iOffsetX,k-s_iOffsetY),C.setPosition(g+s_iOffsetX,h-s_iOffsetY));y.updateOffset(s_iOffsetX,s_iOffsetY);R.setPosition(b-s_iOffsetX,e-s_iOffsetY);W.setPosition();X.x=a+s_iOffsetX;X.y=c+s_iOffsetY};this.resetFullscreenBut=function(){S&&screenfull.isEnabled&&K.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?V.call(window.document):S.call(window.document.documentElement);sizeHandler()};this.refreshFPS=
function(x){(void 0).setTime(x)};this.refreshLap=function(x,H){W.refreshLap(x,H)};this.refreshRankPosition=function(x){Z.refreshRank(x);Z.alignLeft()};this.refreshCountdown=function(x){var H=Math.ceil(x/1E3),I=(1E3*H-x)/1E3;q.alpha=1-I;q.scaleX=q.scaleY=I;q.text=Math.ceil(x/1E3);u.alpha=q.alpha;u.scaleX=u.scaleY=I;u.text=q.text;if(3===H&&!O[3])O[3]=!0,playSound("3",1,0);else if(2===H&&!O[2])O[2]=!0,playSound("2",1,0);else if(1===H&&!O[1])O[1]=!0,playSound("1",1,0);else if(0===H)for(O[0]=!0,playSound("go",
1,0),x=0;x<O.length;x++)O[x]=!1};this.refreshSpeed=function(x){y.setSpeedIndicator(x)};this.countDownGo=function(){q.scaleX=q.scaleY=1;u.scaleX=u.scaleY=q.scaleY;q.text=TEXT_GO;u.text=TEXT_GO;createjs.Tween.get(q).wait(500).to({alpha:0},1E3,createjs.Ease.cubicIn);createjs.Tween.get(u).wait(500).to({alpha:0},1E3,createjs.Ease.cubicIn)};this.addMiniMapCursor=function(x,H){R.addCursor(x,H)};this.refreshMiniMap=function(x){R.update(x)};this.setLevelInfo=function(x){R.setMapViewInfo(LEVEL_INFO[x].minimap.x,
LEVEL_INFO[x].minimap.y,LEVEL_INFO[x].minimap.scale,LEVEL_INFO[x].minimap.rot);R.setLabel(sprintf(TEXT_TRACK,x+1))};this._onButRestartRelease=function(){O=[];for(var x=0;3>=x;x++)O[x]=!1;s_oGame.restartGame()};this.onExitFromHelp=function(){_oHelpPanel.unload()};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){s_oGame.setPause();new CAreYouSurePanel(s_oGame.onExit,s_oGame.setResume)};s_oInterface=this;this._init();return this}
var s_oInterface=null;
function CHelpPanel(){var a,c,b,e,f,l;this._init=function(){f=new createjs.Shape;f.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);f.alpha=1;f.on("mousedown",function(){g._onExitHelp()});s_oStage.addChild(f);(new createjs.Tween.get(f)).to({alpha:.7},500);l=new createjs.Container;l.on("pressup",function(){g._onExitHelp()});s_oStage.addChild(l);var h=s_oSpriteLibrary.getSprite("msg_box"),d=createBitmap(h);d.regX=h.width/2;d.regY=h.height/2;l.addChild(d);l.x=CANVAS_WIDTH/2;l.y=CANVAS_HEIGHT+
h.height/2;a=l.y;(new createjs.Tween.get(l)).to({y:CANVAS_HEIGHT/2-40},500,createjs.Ease.cubicOut);s_bMobile?(b=new CTLText(l,-250,-180,500,48,30,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_HELP1_MOBILE,!0,!0,!0,!1),b.setStroke(6,"#000"),h=s_oSpriteLibrary.getSprite("key_left"),d=createBitmap(h),d.x=-170,d.y=-70,d.regX=h.width/2,d.regY=h.height/2,d.scaleX=d.scaleY=.7,l.addChild(d),h=s_oSpriteLibrary.getSprite("key_right"),d=createBitmap(h),d.x=-80,d.y=-70,d.regX=h.width/2,d.regY=h.height/2,d.scaleX=d.scaleY=
.7,l.addChild(d),h=s_oSpriteLibrary.getSprite("key_down"),d=createBitmap(h),d.x=80,d.y=-70,d.regX=h.width/2,d.regY=h.height/2,d.scaleX=d.scaleY=.7,l.addChild(d),h=s_oSpriteLibrary.getSprite("key_up"),d=createBitmap(h),d.x=170,d.y=-70,d.regX=h.width/2,d.regY=h.height/2,d.scaleX=d.scaleY=.7):(b=new CTLText(l,-300,-170,350,140,30,"center","#fff",PRIMARY_FONT,1.1,0,0,TEXT_HELP1,!0,!0,!0,!1),b.setStroke(6,"#000"),h=s_oSpriteLibrary.getSprite("keys"),d=createBitmap(h),d.x=130,d.y=-100,d.regX=h.width/2,
d.regY=h.height/2);l.addChild(d);e=new CTLText(l,10,24,330,140,30,"left","#fff",PRIMARY_FONT,1.1,0,0,sprintf(TEXT_HELP2,ordinal(MIN_RANK_FOR_WIN)),!0,!0,!0,!1);e.setStroke(6,"#000");d=new createjs.Container;d.x=-160;d.y=130;d.scaleX=d.scaleY=.4;l.addChild(d);h=s_oSpriteLibrary.getSprite("finish");var k=createBitmap(h);k.regX=h.width/2;k.regY=h.height;k.scale=.45;d.addChild(k);new CPlayer(0,150,d)};this.unload=function(){s_oStage.removeChild(f);s_oStage.removeChild(l);l.off("pressup",function(){g._onExitHelp()});
f.off("pressup",function(){g._onExitHelp()})};this._onExitHelp=function(){c||(c=!0,(new createjs.Tween.get(f)).to({alpha:0},500),(new createjs.Tween.get(l)).to({y:a},400,createjs.Ease.backIn).call(function(){g.unload();s_oGame._onExitHelp()}))};var g=this;this._init()}
function CEndPanel(){var a,c,b;this._init=function(){setVolume(s_aSounds.game_soundtrack,SOUNDTRACK_VOLUME_IN_GAME);a=new createjs.Shape;a.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.alpha=0;a.on("mousedown",function(){});s_oStage.addChild(a);(new createjs.Tween.get(a)).to({alpha:.7},500);c=new createjs.Container;s_oStage.addChild(c);var e=s_oSpriteLibrary.getSprite("msg_box"),f=createBitmap(e);f.regX=e.width/2;f.regY=e.height/2;c.addChild(f);c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT+
e.height/2;(new createjs.Tween.get(c)).to({y:CANVAS_HEIGHT/2},500,createjs.Ease.quartIn);(new CTLText(c,-300,-e.height/2+30,600,120,60,"center","#fff",PRIMARY_FONT,1.2,0,0,TEXT_GAMEOVER,!0,!0,!0,!1)).setStroke(10,"#000");e=s_oSpriteLibrary.getSprite("finish");f=createBitmap(e);f.regX=e.width/2;f.regY=e.height;f.y=154;f.scaleX=f.scaleY=.3;c.addChild(f);e=s_oSpriteLibrary.getSprite("but_home");b=new CGfxButton(0,100,e,c);b.addEventListener(ON_MOUSE_UP,this._onHome,this);b.pulseAnimation()};this.unload=
function(){s_oStage.removeChild(c);a.off("mousedown",function(){});b.unload()};this.show=function(){playSound("arrive_win",1,0);$(s_oMain).trigger("share_event",s_iTotalScore)};this._onHome=function(){a.off("mousedown",function(){});s_oStage.removeChild(c);s_oGame.onExit()};this._init();return this}
function CPlayer(a,c,b){var e,f,l,g,h,d,k,n,p,r,m,t,w,y,u,q,E,z,A,C,K,B,O,S,V,R,W,X,Z;this._init=function(x,H,I){V=[];R=[];p=PLAYER_MAX_SPEED;r=PLAYER_ACCELERATION;m=-PLAYER_BRAKING_RATE;t=-PLAYER_DECELERATION;w=-p/2;y=p/4;C=0;K=!0;Z=0;W=new createjs.Container;W.x=x;W.y=H;I.addChild(W);X=new CCarShadow(0,0,W);X.setFrame("center");S=new CHitParticle(0,-340,W);B=createSprite(s_aSpriteSheetCharacters[PLAYER_CAR_TYPE],"center",0,0,0,0);B.gotoAndStop("center");W.addChild(B);u=PLAYER_COLLIDER_WIDTH;q=s_oSpriteLibrary.getSprite("car_0_0").height;
this.reset()};this.reset=function(){h=g=l=f=e=!1;z=E=n=k=d=0;A=STATE_RUNNER_RUN;O=s_oGame.findSegment(d+PLAYER_Z_FROMCAMERA);X.setFrame("center");B.gotoAndStop("center")};this.setY=function(x){W.y=x};this.addEventListener=function(x,H,I){V[x]=H;R[x]=I};this.setAcceleration=function(x){r=x};this.setMaxSpeed=function(x){p=x;m=-p;t=-PLAYER_DECELERATION;w=-p/2;y=p/4};this.stopAll=function(){this.stopLeft();this.stopRight();this.stopAccelerate()};this.stopLeft=function(){e&&(e=!1,stopSound(s_aSounds.brake))};
this.stopRight=function(){f&&(f=!1,stopSound(s_aSounds.brake))};this.stopAccelerate=function(){l=!1;stopSound(s_aSounds.engine)};this.stopBrake=function(){g=!1};this.moveLeft=function(){0!==n&&(soundPlaying(s_aSounds.brake)||playSound("brake",.5,!1),f=!1,e=!0)};this.moveRight=function(){0!==n&&(soundPlaying(s_aSounds.brake)||playSound("brake",.5,!1),e=!1,f=!0)};this.moveAccelerate=function(){g=!1;l=!0};this.moveBrake=function(){l=!1;g=!0};this.getCursor=function(){var x=new createjs.Shape;x.graphics.beginFill(TYPE_CAR_COLOR[s_iCharacterSelected][0]);
x.graphics.moveTo(0,-30);x.graphics.lineTo(-30,30);x.graphics.lineTo(0,0);x.graphics.lineTo(0,-30);x.graphics.beginFill(TYPE_CAR_COLOR[s_iCharacterSelected][1]);x.graphics.moveTo(0,-30);x.graphics.lineTo(30,30);x.graphics.lineTo(0,0);x.graphics.lineTo(0,-30);return x};this._increase=function(x,H,I){for(x+=H;x>=I;)x-=I,C++,V[ON_PLAYER_PASSED_LAP]&&V[ON_PLAYER_PASSED_LAP].call(R[ON_PLAYER_PASSED_LAP],C),K?K=!1:V[ON_PLAYER_COMPLETE_LAP]&&V[ON_PLAYER_COMPLETE_LAP].call(R[ON_PLAYER_COMPLETE_LAP],C);for(;0>
x;)x+=I;return x};this._accelerate=function(x,H,I){return x+H*I};this._limit=function(x,H,I){return Math.max(H,Math.min(x,I))};this.getPlayerWidth=function(){return u};this.getSpriteCenterPos=function(){return{x:a,y:c-q/2-100}};this.getPosition=function(){return{x:k,z:d}};this.setPosition=function(x){d=x};this.setXOffset=function(x){k=x};this.getRunDistance=function(){return d+(C-1)*TRACK_LENGTH+ENEMY_FLANKING_Z_OFFSET};this.autoAcceleration=function(){};this.autoPilot=function(){.5<k?(f=!1,e=!0):
-.5>k?(f=!0,e=!1):.1>=k&&-.1<=k&&(f=e=!1)};this.getMaxSpeed=function(){return p};this.getCurSpeed=function(){return n};this.setCurSpeed=function(x){n=x};this.setRank=function(x){Z!==x&&(Z=x,V[ON_PLAYER_CHANGE_RANK]&&V[ON_PLAYER_CHANGE_RANK].call(R[ON_PLAYER_CHANGE_RANK],Z))};this.getRank=function(){return Z};this.getPlayerSegment=function(){return O};this.getFrontPlayerSegment=function(){return s_oGame.findSegment(d+SEGMENT_LENGTH+PLAYER_Z_FROMCAMERA)};this.getContainer=function(){return W};this.damageAnim=
function(x,H){0<H?(c=0,100>H&&(c=80,x=0<x?PLAYER_RELATIVE_DAMAGE_X_DISTANCE:-PLAYER_RELATIVE_DAMAGE_X_DISTANCE)):c=240;var I=linearFunction(x,-PLAYER_RELATIVE_DAMAGE_X_DISTANCE,PLAYER_RELATIVE_DAMAGE_X_DISTANCE,-120,120);S.play(I,c)};this.isOutOfRoad=function(){return h};this.stopEngineSound=function(){stopSound(s_aSounds.engine);stopSound(s_aSounds.engine_stall)};this._getSideFromCornering=function(){var x="center";0<z?(x=z-1,x="right_"+x):0>z&&(x=-z-1,x="left_"+x);return x};this._setDirectionFromCornering=
function(){var x=this._getSideFromCornering();X.setFrame(x);B.gotoAndStop(x)};this._updateCornering=function(x){x=PLAYER_CORNERING_INCREASE_RATIO;e?E-=x:f?E+=x:0<E?(E-=x,0>E&&(E=0)):0>E&&(E+=x,0<E&&(E=0));E>PLAYER_CORNERING_WEIGHT?E=PLAYER_CORNERING_WEIGHT:E<-PLAYER_CORNERING_WEIGHT&&(E=-PLAYER_CORNERING_WEIGHT)};this._updateXMovement=function(x,H){var I=x*H*H*O.curve*CENTRIFUGAL_FORCE/TERRAIN_ADHERENCE;x=linearFunction(E,-PLAYER_CORNERING_WEIGHT,PLAYER_CORNERING_WEIGHT,-.044,.044)*H;k=k-I+x};this._calculateCornering=
function(){var x=linearFunction(E,PLAYER_CORNERING_WEIGHT,-PLAYER_CORNERING_WEIGHT,4,-4);return Math.round(x)};this._updateRunAnimation=function(){var x=this._calculateCornering();x!==z&&(z=x,this._setDirectionFromCornering())};this.frontCollision=function(){n-=PLAYER_SPEED_LOST_WHEN_COLLIDED};this.lateralCollision=function(x,H){A=STATE_RUNNER_HURTED;var I={value:z},v=-1;0>x&&(v=1);n-=PLAYER_SPEED_LOST_WHEN_COLLIDED;var G=this;createjs.Tween.get(I).to({value:4*v},200,createjs.Ease.cubicOut).call(function(){A=
STATE_RUNNER_RUN}).on("change",function(){z=Math.round(I.value);k+=.002*z;E=.1*v;G._setDirectionFromCornering()})};this.checkOutOfRoad=function(){h=!1;var x=(s_oGame.rumbleCondition(O)?1.35:1)-.1;if(k<-x||k>x)h=!0};this.update=function(x){O=s_oGame.findSegment(d+PLAYER_Z_FROMCAMERA);var H=n/p;d=this._increase(d,x*n,TRACK_LENGTH);var I=2*x*TERRAIN_ADHERENCE*H;A!==STATE_RUNNER_HURTED&&A!==STATE_RUNNER_DEATH&&(this._updateCornering(H),this._updateXMovement(I,H));A===STATE_RUNNER_RUN&&this._updateRunAnimation(H);
r=linearFunction(n,0,PLAYER_MAX_SPEED,PLAYER_ACCELERATION,0);l?(n=this._accelerate(n,r,x),1===H?soundPlaying(s_aSounds.engine_stall)||(stopSound(s_aSounds.engine),stopSound(s_aSounds.engine_reverse),playSound("engine_stall",.7,!0)):0<n&&!soundPlaying(s_aSounds.engine)&&!s_oGame.playerCollide()&&(stopSound(s_aSounds.brake),stopSound(s_aSounds.engine_stall),stopSound(s_aSounds.engine_reverse),playSound("engine",.7,!1),soundSeek(s_aSounds.engine,.15))):g?(n=this._accelerate(n,m,x),0<n&&(stopSound(s_aSounds.engine),
stopSound(s_aSounds.engine_stall),stopSound(s_aSounds.engine_reverse),soundPlaying(s_aSounds.brake)||playSound("brake",.5,!1))):(n=this._accelerate(n,t,x),0<n&&!soundPlaying(s_aSounds.engine_reverse)&&(stopSound(s_aSounds.brake),stopSound(s_aSounds.engine_stall),stopSound(s_aSounds.engine),playSound("engine_reverse",.7,!1),H=linearFunction(H,0,1,soundDuration(s_aSounds.engine_reverse),0),soundSeek(s_aSounds.engine_reverse,H)));this.checkOutOfRoad();n>y&&h&&(n=this._accelerate(n,w,x));k=this._limit(k,
-ROAD_BOUNDS,ROAD_BOUNDS);n=this._limit(n,0,p)};this._init(a,c,b)}
function CRoad(a,c,b,e,f,l,g){var h,d,k,n,p,r;this._init=function(m,t,w){h=null;d=CAMERA_DEPTH;k=.5*DRAW_DISTANCE;n=[];this.resetRoad()};this.findSegment=function(m){return n[Math.floor(m/SEGMENT_LENGTH)%n.length]};this.getLastVisibleSegment=function(){};this.lastX=function(){return 0===n.length?0:n[n.length-1].p2.world.x};this.lastY=function(){return 0===n.length?0:n[n.length-1].p2.world.y};this.addSegment=function(m,t){var w=n.length;n.push({index:w,p1:{world:{x:this.lastX(),y:this.lastY(),z:w*
SEGMENT_LENGTH},camera:{},screen:{},projectX:0},p2:{world:{x:this.lastX()+m,y:t,z:(w+1)*SEGMENT_LENGTH},camera:{},screen:{},projectX:0},curve:m,elements:[],cars:[],enemy:[],color:Math.floor(w/RUMBLE_LENGTH)%2?COLORS.DARK:COLORS.LIGHT,color_alt:Math.floor(w/RUMBLE_LENGTH)%2?LEVEL_INFO[0].terrain.color_alt.dark:LEVEL_INFO[0].terrain.color_alt.light})};this.addRoad=function(m,t,w,y,u){var q=this.lastY();u=q+Util.toInt(u,0)*SEGMENT_LENGTH;var E,z=m+t+w;for(E=0;E<m;E++)this.addSegment(Util.easeIn(0,y,
E/m),Util.easeInOut(q,u,E/z));for(E=0;E<t;E++)this.addSegment(y,Util.easeInOut(q,u,(m+E)/z));for(E=0;E<w;E++)this.addSegment(Util.easeInOut(y,0,E/w),Util.easeInOut(q,u,(m+t+E)/z))};this.addStraight=function(m){m=m||ROAD.LENGTH.MEDIUM;this.addRoad(m,m,m,0)};this.addHill=function(m,t){m=m||ROAD.LENGTH.MEDIUM;t=t||ROAD.HILL.MEDIUM;this.addRoad(m,m,m,0,t)};this.addCurve=function(m,t,w){m=m||ROAD.LENGTH.MEDIUM;t=t||ROAD.CURVE.MEDIUM;this.addRoad(m,m,m,t)};this.addStandardRoad=function(m,t,w){m=m||ROAD.LENGTH.MEDIUM;
t=t||ROAD.CURVE.NONE;w=w||ROAD.HILL.NONE;this.addRoad(m,m,m,t,w)};this.addLowRollingHills=function(m,t){m=m||ROAD.LENGTH.SHORT;t=t||ROAD.HILL.LOW;this.addRoad(m,m,m,0,t/2);this.addRoad(m,m,m,0,-t);this.addRoad(m,m,m,ROAD.CURVE.EASY,t);this.addRoad(m,m,m,0,0);this.addRoad(m,m,m,-ROAD.CURVE.EASY,t/2);this.addRoad(m,m,m,0,0)};this.addSCurves=function(m,t,w){m=m||ROAD.LENGTH.MEDIUM;t=t||ROAD.CURVE.MEDIUM;w=w||ROAD.HILL.NONE;var y=0<=t?1:-1;var u=0<=w?1:-1;t=Math.abs(t);w=Math.abs(w);switch(t){case ROAD.CURVE.EASY:var q=
ROAD.CURVE.NONE;var E=ROAD.CURVE.EASY;break;case ROAD.CURVE.MEDIUM:q=ROAD.CURVE.EASY;E=ROAD.CURVE.MEDIUM;break;case ROAD.CURVE.HARD:q=ROAD.CURVE.MEDIUM,E=ROAD.CURVE.HARD}switch(w){case ROAD.HILL.EASY:var z=ROAD.HILL.NONE;var A=ROAD.HILL.LOW;break;case ROAD.HILL.MEDIUM:z=ROAD.HILL.LOW;A=ROAD.HILL.MEDIUM;break;case ROAD.HILL.HIGH:z=ROAD.HILL.MEDIUM,A=ROAD.HILL.HIGH}this.addRoad(m,m,m,y*q,ROAD.HILL.NONE);this.addRoad(m,m,m,y*E,u*A);this.addRoad(m,m,m,y*q,-u*z);this.addRoad(m,m,m,-y*q,u*A);this.addRoad(m,
m,m,-y*E,-u*z)};this.addBumps=function(m,t){m=m||ROAD.LENGTH.SHORT/2;t=t||ROAD.CURVE.NONE;this.addRoad(m,m,m,0,m/2.5);this.addRoad(m,m,m,0,-m/6.25);this.addRoad(m,m,m,t,-m/2.5);this.addRoad(m,m,m,0,m/1,5625);this.addRoad(m,m,m,0,m/2.5);this.addRoad(m,m,m,-t,-m/1.785);this.addRoad(m,m,m,0,m/2.5);this.addRoad(m,m,m,0,-m/6.25)};this.addDownhillToEnd=function(m,t){m=m||200;t=t||ROAD.CURVE.NONE;this.addRoad(m,m,m,t,-Math.round(this.lastY()/SEGMENT_LENGTH))};this.resetRoad=function(){n=[];for(var m=ROAD_INFO[b],
t=0;t<m.length;t++){var w=m[t];switch(w.roadtype){case ROAD.TYPE.STANDARD:this.addStandardRoad(w.length,w.curve,w.hill);break;case ROAD.TYPE.CURVE_S:this.addSCurves(w.length,w.curve,w.hill);break;case ROAD.TYPE.BUMPS:this.addBumps(w.length,w.curve);break;case ROAD.TYPE.FINAL:this.addDownhillToEnd(w.length,w.curve)}}n[this.findSegment(PLAYER_Z_FROMCAMERA).index+2].color=COLORS.START;n[this.findSegment(PLAYER_Z_FROMCAMERA).index+3].color=COLORS.START;for(m=0;m<RUMBLE_LENGTH;m++)n[n.length-1-m].color=
COLORS.FINISH;h=n.length*SEGMENT_LENGTH};this.setCameraDepth=function(m){d=m};this.update=function(m){a.graphics.clear();e.graphics.clear();f.graphics.clear();l.graphics.clear();g.graphics.clear();r=m.z-PLAYER_Z_FROMCAMERA;m=m.x;r=getModule(r,h);var t=this.findSegment(r),w=Util.percentRemaining(r,SEGMENT_LENGTH),y=this.findSegment(r+PLAYER_Z_FROMCAMERA),u=Util.percentRemaining(r+PLAYER_Z_FROMCAMERA,SEGMENT_LENGTH);y=Util.interpolate(y.p1.world.y,y.p2.world.y,u);var q=HEIGHT_ROTATION_VIEW,E=0,z=-(t.curve*
w),A=m*ROAD_WIDTH;w=y+CAMERA_HEIGHT;y=rotateSimpleVector2D((8<t.curve?8:t.curve)/5*-1,{x:1,y:0});u=LEVEL_INFO[b].terrain.color.light.grass;var C=LEVEL_INFO[b].terrain.color.dark.grass;f.graphics.beginLinearGradientFill([C,u,u,u,C],[.1,.4,.5,.6,.9],0,0,CANVAS_WIDTH,y.y*CANVAS_HEIGHT);u=LEVEL_INFO[b].terrain.color.light.road;C=LEVEL_INFO[b].terrain.color.dark.road;a.graphics.beginLinearGradientFill([C,u,u,u,C],[.1,.4,.5,.6,.9],0,0,CANVAS_WIDTH,y.y*CANVAS_HEIGHT);y=LEVEL_INFO[b].terrain.color.light.rumble;
g.graphics.setStrokeStyle(2);g.graphics.beginStroke(y);p=[];for(y=0;y<DRAW_DISTANCE;y++){u=n[(t.index+y)%n.length];u.looped=u.index<t.index;u.clip=q;C=r-(u.looped?h:0);var K=A-E;Util.project(u.p1,K,w,C,d);Util.project(u.p2,K-z,w,C,d);E+=z;z+=u.curve;if(!(u.p1.camera.z<=d||u.p2.screen.y>=u.p1.screen.y||u.p2.screen.y>=q)){q=Math.round(u.p1.screen.x);C=Math.round(u.p1.screen.y);K=Math.round(u.p1.screen.w);var B=Math.round(u.p2.screen.x),O=Math.round(u.p2.screen.y),S=Math.round(u.p2.screen.w);(u.start||
u.end)&&Render.segment(l,WIDTH_ROTATION_VIEW,NUM_LANES,q,C,K,B,O,S,u.color);Render.grass(f,WIDTH_ROTATION_VIEW,NUM_LANES,q,C,K,B,O,S);Render.simpleSegment(a,WIDTH_ROTATION_VIEW,NUM_LANES,q,C,K,B,O,S);s_oGame.rumbleCondition(u)?Render.rumble(e,WIDTH_ROTATION_VIEW,NUM_LANES,q,C,K,B,O,S,u.color):Render.rumble(e,WIDTH_ROTATION_VIEW,NUM_LANES,q,C,K,B,O,S,u.color_alt);Render.stroke(g,WIDTH_ROTATION_VIEW,NUM_LANES,q,C,K,B,O,S,u.color);q=u.p2.screen.y}}for(y=DRAW_DISTANCE-1;0<y;y--){u=n[(t.index+y)%n.length];
E=linearFunction(y,DRAW_DISTANCE,k,0,1);for(z=0;z<u.cars.length;z++)A=u.cars[z],q=A.getZ()-r,C=A.getOffset()-m,q>CAR_FARVIEW_OFFSET?u.curve>-CAR_CURVEVIEW_OFFSET&&u.curve<CAR_CURVEVIEW_OFFSET?A.setDirection(CAR_CENTER):u.curve<CAR_CURVEVIEW_OFFSET?A.setDirection(CAR_LEFT):A.setDirection(CAR_RIGHT):C>-CAR_SIDEVIEW_OFFSET&&A.getOffset()-m<CAR_SIDEVIEW_OFFSET?A.setDirection(CAR_CENTER):C<-CAR_SIDEVIEW_OFFSET?A.setDirection(CAR_RIGHT):A.setDirection(CAR_LEFT),q=A.getSprite(),K=Util.interpolate(u.p1.screen.scale,
u.p2.screen.scale,A.getPercent()),C=Util.interpolate(u.p1.screen.x,u.p2.screen.x,A.getPercent())+K*A.getOffset()*ROAD_PER_HALF_CANVAS_WIDTH,B=Util.interpolate(u.p1.screen.y,u.p2.screen.y,A.getPercent()),A.setVisible(!0),this._addToDepthArray(A,K),K*=ROAD_PER_SCALE_PER_HALF_CANVAS_WIDTH_ANIMATED,Render.sprite(q,A.getContainer(),K,C,B,-.5,-1,u.clip);for(z=0;z<u.enemy.length;z++)q=u.enemy[z],A=q.getSpriteBounds(),C=Util.interpolate(u.p1.world.y,u.p2.world.y,q.getPercent()),B=q.getOffset()*ROAD_WIDTH,
K=Util.interpolate(u.p1.projectX,u.p2.projectX,q.getPercent()),B={x:B,y:C,z:q.getZ()},C=r-(u.looped?h:0),B=Util.get3dto2dCoord(B,K,w,C,d),K=B.scale,C=B.x,B=B.y,q.setVisible(!0),q.setAlpha(E),this._addToDepthArray(q,K),K*=ROAD_PER_SCALE_PER_HALF_CANVAS_WIDTH_ANIMATED,Render.spriteWithMask(A,q.getContainer(),K,C,B,-.5,-1,u.clip,q.getMask());for(z=0;z<u.elements.length;z++)q=u.elements[z].source,A=q.getContainer().getBounds(),K=u.p1.screen.scale,C=u.p1.screen.x+K*q.getOffset()*ROAD_PER_HALF_CANVAS_WIDTH,
B=u.p1.screen.y,q.setVisible(!0),q.setAlpha(E),this._addToDepthArray(q,K),K*=ROAD_PER_SCALE_PER_HALF_CANVAS_WIDTH,Render.spriteWithMask(A,q.getContainer(),K,C,B,0,-1,u.clip,q.getMask())}this._addToDepthArray(s_oGame.getPlayer(),8E-4);this.sortElementsDepth();this.clearElementsBehind(t)};this._addToDepthArray=function(m,t){p.push({obj:m,depth:t})};this.sortElementsDepth=function(){p.sort(this._sortDepthFunction);for(var m=0;m<p.length;m++){var t=p[m].obj.getContainer(),w=p[m].depth;c.setChildIndex(t,
m);w>PLAYER_DEPTH_SWAP&&(t.alpha=linearFunction(w,PLAYER_DEPTH_SWAP,DEPTH_DISTANCE_TO_FADE_ELEMENTS,1,0))}};this._sortDepthFunction=function(m,t){return m.depth>t.depth?1:m.depth<t.depth?-1:0};this.clearElementsBehind=function(m){m=(m.index-25)%n.length;0<m?this.clearElementsInSegments(m,m+25):this.clearElementsInSegments(n.length+m-1,n.length)};this.clearElementsInSegments=function(m,t){for(var w,y,u=m;u<t;u++){w=n[u];for(var q=0;q<w.elements.length;q++)y=w.elements[q].source,y.setVisible(!1);for(q=
0;q<w.cars.length;q++)y=w.cars[q],y.setVisible(!1);for(q=0;q<w.enemy.length;q++)y=w.enemy[q],y.setVisible(!1)}};this.exponentialFog=function(m,t){return 1/Math.pow(Math.E,m*m*t)};this.getTrackLength=function(){return h};this.getSegments=function(){return n};this._init(a,c,b)}
function CLevelBuilder(a,c,b,e,f){var l;this._init=function(g,h,d,k,n){l=LEVEL_INFO[n].num_cars;this._initTerrainInfo();this._initSprites();this._initCars()};this._attachSprites=function(){for(var g=0;g<s_oGame.getSegments().length;g++)for(var h=s_oGame.getSegments()[g].elements,d=0;d<h.length;d++)e.addChildAt(h[d].source,0)};this._addSprite=function(g,h,d){if(void 0!==s_oGame.getSegments()[g]){switch(h.type||ELEMENT_TYPE_STATIC){case ELEMENT_TYPE_STATIC:var k=new CElementStatic(h,d,g,e);break;case ELEMENT_TYPE_ANIMATED:k=
new CElementAnimated(h,d,g,e);k.stopAnim();break;case ELEMENT_TYPE_LIGHT:k=new CElementLight(h,d,g,e)}s_oGame.getSegments()[g].elements.push({source:k,offset:d,bounds:k.getContainer().getBounds(),name:h.name})}};this._addDensityElements=function(g,h,d,k,n,p,r){p=p||100;r=r||1;if(g===AMBIENT.SIDE.BOTH)this._addDensityElements(AMBIENT.SIDE.RIGHT,h,d,k,n,p,r),this._addDensityElements(AMBIENT.SIDE.LEFT,h,d,k,n,p,r);else for(;d<=k;d+=r)if(100*Math.random()<=p){var m=d+Util.randomInt(0,5);this._addSprite(m,
h,g+g*n+2*g*Math.random())}};this._addPreciseElements=function(g,h,d,k,n,p,r){p=p||100;r=r||1;if(g===AMBIENT.SIDE.BOTH)this._addPreciseElements(AMBIENT.SIDE.RIGHT,h,d,k,n,p,r),this._addPreciseElements(AMBIENT.SIDE.LEFT,h,d,k,n,p,r);else for(;d<=k;d+=r)if(100*Math.random()<=p){var m=d,t=g+g*n;g===AMBIENT.SIDE.CENTER&&(t=n);this._addSprite(m,h,t)}};this._initSprites=function(){var g,h=AMBIENT_INFO[f];for(g=0;g<h.length;g++){var d=h[g];switch(d.type){case AMBIENT.TYPE.FILL_TRACK:this._processFillTrack(d);
break;case AMBIENT.TYPE.FILL_CURVE:this._processFillCurve(d);break;case AMBIENT.TYPE.FINISH:this._initFinishLane(d);break;case AMBIENT.TYPE.ANIMATION:this._initAnimationGroup(d);break;default:this._processNormalType(d)}}};this._initAnimationGroup=function(g){console.log(g);this._processNormalType(g);var h=this._getAnimationProperty(g);this._applyAnimationEffects(g,h)};this._getAnimationProperty=function(g){var h=this._getSegmentRange(g.segments),d=h.start,k=h.end,n=s_oGame.getSegments();for(h=[];d<=
k;d++)for(var p=n[d].elements,r=0;r<p.length;r++){var m=p[r];m.name===g.sprite.name&&h.push(m)}k=[];for(d=0;d<h.length;d++)k.push(d);n=ANIMATE_GROUP.EFFECT.NONE;if(void 0!==g.animate){switch(g.animate.index){case ANIMATE_GROUP.QTY.ALL:break;case ANIMATE_GROUP.QTY.RANDOM:p=.5;void 0!==g.animate.random_strenght&&(p=g.animate.random_strenght);for(d=0;d<k.length;d++)Math.random()>p&&(k.splice(d,1),d--);break;default:k=g.animate.index}void 0!==g.animate.effect&&(n=g.animate.effect)}g=[];for(d=0;d<k.length;d++)g.push(h[k[d]]);
return{elements_to_animate:g,effect:n}};this._applyAnimationEffects=function(g,h){var d=h.elements_to_animate,k=h.effect;switch(g.sprite.type){case ELEMENT_TYPE_ANIMATED:for(var n=s_aSpriteSheetElements[g.sprite.name],p=0;p<d.length;p++){var r=0;k===ANIMATE_GROUP.EFFECT.RANDOM&&(r=Math.floor(Math.random()*n.getNumFrames("anim")));d[p].source.playAtFrame(r)}break;case ELEMENT_TYPE_LIGHT:switch(k){case ANIMATE_GROUP.EFFECT.LIGHT_BROKEN:for(p=0;p<d.length;p++)d[p].source.brokenInterval(200);break;case ANIMATE_GROUP.EFFECT.LIGHT_REGULAR:for(p=
0;p<d.length;p++)d[p].source.regularInterval(600);break;case ANIMATE_GROUP.EFFECT.WATERFALL:for(n=300*d.length,console.log(d.length),p=0;p<d.length;p++)r=d[p].source,r.intensity(0),k=300*p,r.lit(k,300,n,2800)}}};this._processFillTrack=function(g){var h=s_oGame.getSegments(),d=AMBIENT.DISPOSITION.DENSITY;void 0!==g.disposition&&(d=g.disposition);var k=AMBIENT.SIDE.BOTH;void 0!==g.side&&(k=g.side);var n=g.sprite;d===AMBIENT.DISPOSITION.DENSITY?this._addDensityElements(k,n,0,h.length,g.position,g.occurrence,
g.repetitionevery):this._addPreciseElements(k,n,0,h.length,g.position,g.occurrence,g.repetitionevery)};this._processFillCurve=function(g){for(var h=s_oGame.getSegments(),d=g.repetitionevery,k=0;k<h.length;k++){var n=h[k].curve;0>n?(d--,0>=d&&(d=g.repetitionevery,this._addPreciseElements(AMBIENT.SIDE.RIGHT,g.sprite[0],k,k,g.position,g.occurrence,g.repetitionevery))):0<n?(d--,0>=d&&(d=g.repetitionevery,this._addPreciseElements(AMBIENT.SIDE.LEFT,g.sprite[1],k,k,g.position,g.occurrence,g.repetitionevery))):
d=g.repetitionevery}};this._processNormalType=function(g){var h=this._getSegmentRange(g.segments),d=h.start;h=h.end;switch(g.disposition){case AMBIENT.DISPOSITION.PRECISE:this._addPreciseElements(g.side,g.sprite,d,h,g.position,g.occurrence,g.repetitionevery);break;case AMBIENT.DISPOSITION.DENSITY:this._addDensityElements(g.side,g.sprite,d,h,g.position,g.occurrence,g.repetitionevery)}};this._getSegmentRange=function(g){if(g.constructor===Array){var h=g[0];g=g[1]}else h=g;return{start:h,end:g}};this._initFinishLane=
function(g){var h=s_oGame.getSegments().length-1;this._addSprite(h,g.sprite,0)};this._initCars=function(){var g;for(g=0;g<l;g++){var h=Math.random()*Util.randomChoice([-.8,.8]);var d=Math.floor(Math.random()*s_oGame.getSegments().length)*SEGMENT_LENGTH;var k=Util.randomChoice(SPRITES.CARS);var n=a.getMaxSpeed()/4+Math.random()*a.getMaxSpeed()/(k==SPRITES.SEMI?4:2);h=new CCar(k,h,d,n,e);d=s_oGame.findSegment(d);d.cars.push(h);c.push(h)}};this._initEnemy=function(){var g;for(g=0;g<l;g++){var h=Math.random()*
Util.randomChoice([-.8,.8]);var d=Math.floor(Math.random()*s_oGame.getSegments().length)*SEGMENT_LENGTH;var k=Util.randomChoice(SPRITES.CARS);var n=a.getMaxSpeed()/4+Math.random()*a.getMaxSpeed()/8;h=new COpponent(k,h,d,n,e);d=s_oGame.findSegment(d);d.enemy.push(h);b.push(h)}};this._initTerrainInfo=function(){COLORS.LIGHT.road=LEVEL_INFO[f].terrain.color.light.road;COLORS.LIGHT.grass=LEVEL_INFO[f].terrain.color.light.grass;COLORS.LIGHT.rumble=LEVEL_INFO[f].terrain.color.light.rumble;COLORS.LIGHT.lane=
LEVEL_INFO[f].terrain.color.light.lane;COLORS.DARK.road=LEVEL_INFO[f].terrain.color.dark.road;COLORS.DARK.grass=LEVEL_INFO[f].terrain.color.dark.grass;COLORS.DARK.rumble=LEVEL_INFO[f].terrain.color.dark.rumble;TERRAIN_ADHERENCE=LEVEL_INFO[f].terrain.adherence;TERRAIN_MAX_INERTIA=LEVEL_INFO[f].terrain.max_inertia;NUM_LANES=LEVEL_INFO[f].terrain.num_lanes;ROAD_BOUNDS=LEVEL_INFO[f].terrain.roadbounds};this._init(a,c,b,e,f)}
var ROAD_INFO=[],AMBIENT_INFO=[],LEVEL_INFO=[],ELEMENT_INFO=[[],[],[],[],[],[],[],[],[]];
ROAD_INFO[0]=[{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.CURVE_S,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,
curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.CURVE_S,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.CURVE_S,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.CURVE_S,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG-2},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,
curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.FINAL,length:ROAD.LENGTH.LONG-12}];
LEVEL_INFO[0]={time:7E4,num_cars:0,num_laps:5,minimap:{x:0,y:0,scale:.48,rot:-90},terrain:{roadbounds:2,num_lanes:1,adherence:1,max_inertia:.03,color:{light:{road:"#444444",grass:"#45773f",rumble:"#fff",lane:"#fff"},dark:{road:"#141414",grass:"#1d3f1b",rumble:"#8a1515"}},color_alt:{light:{road:"#444444",grass:"#45773f",rumble:"#0d6b92",lane:"#fff"},dark:{road:"#141414",grass:"#1d3f1b",rumble:"#0d6b92"}}}};
AMBIENT_INFO[0]=[{type:AMBIENT.TYPE.FILL_TRACK,sprite:SPRITES.SECURITY_WALL,position:8,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{type:AMBIENT.TYPE.FINISH,sprite:SPRITES.FINISH},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_2,position:2,segments:[50,50],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_2,position:2,segments:[300,300],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_2,
position:2,segments:[450,450],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_2,position:2,segments:[650,650],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.CENTER,sprite:SPRITES.BILLBOARD_ARC_4,position:0,segments:[850,1250],repetitionevery:40,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_2,position:2,segments:[1850,1850],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},
{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_2,position:2,segments:[2150,2150],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.CENTER,sprite:SPRITES.BILLBOARD_ARC_0,position:0,segments:[2400,2400],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_5,position:2,segments:[2700,2700],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_5,position:2,segments:[2850,
2850],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.CENTER,sprite:SPRITES.BILLBOARD_ARC_0,position:0,segments:[3E3,4400],repetitionevery:30,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_5,position:2,segments:[4550,4550],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_2,position:2,segments:[4850,4850],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,
sprite:SPRITES.BILLBOARD_2,position:2,segments:[5150,5150],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_1,position:2,segments:[5450,5450],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_1,position:2,segments:[5750,5750],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.CENTER,sprite:SPRITES.BILLBOARD_ARC_2,position:0,segments:[5950,7250],repetitionevery:100,
disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.CENTER,sprite:SPRITES.BILLBOARD_ARC_3,position:0,segments:[6E3,7200],repetitionevery:100,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD_1,position:2,segments:[7500,7700],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD_5,position:2,segments:[7500,7700],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE}];
ROAD_INFO[1]=[{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:-ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:-ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,
length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.MEDIUM},
{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG-65},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:-ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG},{roadtype:ROAD.TYPE.STANDARD,
length:ROAD.LENGTH.EXTRALONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.FINAL,length:ROAD.LENGTH.MEDIUM-24}];
LEVEL_INFO[1]={time:65E3,num_cars:0,num_laps:5,minimap:{x:0,y:18,scale:.54,rot:-30},terrain:{roadbounds:2,num_lanes:1,adherence:1,max_inertia:.03,color:{light:{road:"#444444",grass:"#45773f",rumble:"#fff",lane:"#fff"},dark:{road:"#141414",grass:"#1d3f1b",rumble:"#8a1515"}},color_alt:{light:{road:"#444444",grass:"#45773f",rumble:"#0d6b92",lane:"#fff"},dark:{road:"#141414",grass:"#1d3f1b",rumble:"#0d6b92"}}}};
AMBIENT_INFO[1]=[{type:AMBIENT.TYPE.FILL_TRACK,sprite:SPRITES.SECURITY_WALL,position:8,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{type:AMBIENT.TYPE.FILL_TRACK,sprite:SPRITES.BILLBOARD_2,position:5,repetitionevery:500,occurrence:30},{type:AMBIENT.TYPE.FINISH,sprite:SPRITES.FINISH},{side:AMBIENT.SIDE.CENTER,sprite:SPRITES.BILLBOARD_ARC_0,position:0,segments:[200,400],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.CENTER,sprite:SPRITES.BILLBOARD_ARC_3,
position:0,segments:[4500,5400],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_0,segments:[5700,6E3],position:2,occurrence:30,repetitionevery:50,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_1,segments:[6100,6500],position:2,occurrence:30,repetitionevery:50,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_0,segments:[6600,7200],position:2,occurrence:30,
repetitionevery:50,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_1,segments:[7500,8800],position:3,occurrence:50,repetitionevery:50,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.CENTER,sprite:SPRITES.BILLBOARD_ARC_0,position:0,segments:[7500,8800],repetitionevery:100,disposition:AMBIENT.DISPOSITION.PRECISE}];
ROAD_INFO[2]=[{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:-ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,
length:ROAD.LENGTH.EXTRALONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG-30},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM},
{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM+20},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:-ROAD.CURVE.HARD},
{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.FINAL,length:ROAD.LENGTH.MEDIUM+28}];
LEVEL_INFO[2]={time:7E4,num_cars:0,num_laps:5,minimap:{x:0,y:0,scale:.6,rot:0},terrain:{roadbounds:2,num_lanes:1,adherence:1,max_inertia:.03,color:{light:{road:"#444444",grass:"#45773f",rumble:"#fff",lane:"#fff"},dark:{road:"#141414",grass:"#1d3f1b",rumble:"#8a1515"}},color_alt:{light:{road:"#444444",grass:"#45773f",rumble:"#0d6b92",lane:"#fff"},dark:{road:"#141414",grass:"#1d3f1b",rumble:"#0d6b92"}}}};
AMBIENT_INFO[2]=[{type:AMBIENT.TYPE.FILL_TRACK,sprite:SPRITES.SECURITY_WALL,position:8,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{type:AMBIENT.TYPE.FINISH,sprite:SPRITES.FINISH},{side:AMBIENT.SIDE.CENTER,sprite:SPRITES.BILLBOARD_ARC_1,position:0,segments:[200,750],repetitionevery:30,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.CENTER,sprite:SPRITES.BILLBOARD_ARC_2,position:0,segments:[1350,1600],repetitionevery:40,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.CENTER,
sprite:SPRITES.BILLBOARD_ARC_2,position:0,segments:[1700,2300],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD_4,position:2,segments:[2350,2350],repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.CENTER,sprite:SPRITES.BILLBOARD_ARC_1,position:0,segments:[2600,3200],repetitionevery:60,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.CENTER,sprite:SPRITES.BILLBOARD_ARC_0,position:0,segments:[3500,4E3],
repetitionevery:60,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD_3,position:2,segments:[4300,5100],repetitionevery:100,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD_3,position:2,segments:[4350,5150],repetitionevery:100,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.CENTER,sprite:SPRITES.BILLBOARD_ARC_1,position:0,segments:[6E3,6900],repetitionevery:100,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,
sprite:SPRITES.BILLBOARD_3,position:2,segments:[6050,6900],repetitionevery:300,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD_4,position:2,segments:[6850,6850],repetitionevery:300,disposition:AMBIENT.DISPOSITION.PRECISE}];
function CHorizon(a,c){var b,e,f;this._init=function(l){b=0;f=new createjs.Container;f.x=-HALF_CANVAS_WIDTH;c.addChild(f);e=[];var g=Math.floor(l/NUM_TRACKS_PER_WORLD);l="w"+g+"_bg1";var h="w"+g+"_bg2";g=s_oSpriteLibrary.getSprite("w"+g+"_bg0");this._addBG(g);g=s_oSpriteLibrary.getSprite(l);this._addBG(g);g=s_oSpriteLibrary.getSprite(h);this._addBG(g)};this._addBG=function(l){l=new CBackground(l,f);e.push(l)};this.resetPos=function(){b=0};this.restart=function(){for(var l=0;l<e.length;l++)e[l].restart()};
this.move=function(l){var g=b-l.x;e[0].moveX(g);e[1].moveX(g*PARALLAX_RATIO_X_1);e[2].moveX(g*PARALLAX_RATIO_X_2);b=l.x};this._init(a)}
function CBackground(a,c){var b,e,f;this._init=function(){b=a.height/2-(CANVAS_HEIGHT-2*s_iOffsetY)/2;f=new createjs.Container;c.addChild(f);e=[];for(var l=0;2>l;l++)e[l]=createBitmap(a),e[l].x=l*a.width,f.addChild(e[l]),e[l].cache(0,0,a.width,a.height)};this.restart=function(){f.x=0;for(var l=f.y=0;2>l;l++)e[l].x=l*a.width};this.moveX=function(l){f.x+=l;l=Math.floor((-f.x+HALF_CANVAS_WIDTH)/a.width)*a.width;for(var g=0;2>g;g++)e[g].x=l+g*a.width};this.moveY=function(l){l<-b&&(l=-b);l>b&&(l=b);f.y=
l};this._init()}
function CNextLevelPanel(a,c,b){var e,f,l,g,h;this._init=function(k,n,p){playSound("arrive_win",1,!1);setVolume(s_aSounds.game_soundtrack,SOUNDTRACK_VOLUME_IN_GAME);l=new createjs.Shape;l.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);l.alpha=0;l.on("mousedown",function(){});s_oStage.addChild(l);(new createjs.Tween.get(l)).to({alpha:.7},500);f=new createjs.Container;s_oStage.addChild(f);p=s_oSpriteLibrary.getSprite("msg_box");var r=createBitmap(p);r.regX=p.width/2;r.regY=p.height/
2;f.addChild(r);(new CTLText(f,-300,-200,600,60,60,"center","#fff",PRIMARY_FONT,1.1,0,0,TEXT_TRACK_COMPLETED,!0,!0,!1,!1)).setStroke(10,"#000");r=new createjs.Container;r.x=-120;r.y=-50;f.addChild(r);switch(k){case 1:p=s_oSpriteLibrary.getSprite("gold_cup");break;case 2:p=s_oSpriteLibrary.getSprite("silver_cup");break;case 3:p=s_oSpriteLibrary.getSprite("bronze_cup")}k=createBitmap(p);k.regX=p.width/2;k.regY=p.height/2;k.scale=.5;r.addChild(k);k=new createjs.Container;k.x=120;k.y=-50;f.addChild(k);
p=s_oSpriteLibrary.getSprite("star");r=createBitmap(p);r.regX=p.width/2;r.regY=p.height/2;k.addChild(r);var m=new CTLText(k,50,-20,150,50,50,"left","#fff",PRIMARY_FONT,1,0,0,"0",!0,!0,!1,!1);m.setStroke(10,"#000");f.x=CANVAS_WIDTH/2;f.y=CANVAS_HEIGHT+p.height/2;e=f.y;(new createjs.Tween.get(f)).to({y:CANVAS_HEIGHT/2},500,createjs.Ease.quartIn).call(function(){m.roll(n,5E3,createjs.Ease.cubicOut)});p=s_oSpriteLibrary.getSprite("but_next");g=new CGfxButton(120,100,p,f);g.addEventListener(ON_MOUSE_UP,
this._onContinue,this);g.pulseAnimation();p=s_oSpriteLibrary.getSprite("but_restart");h=new CGfxButton(-120,100,p,f);h.addEventListener(ON_MOUSE_UP,this._onRestart,this)};this.unload=function(){l.off("mousedown",function(){});s_oStage.removeChild(l);f.removeAllChildren(l);g.unload();h.unload()};this._onContinue=function(){h.setClickable(!1);g.setClickable(!1);(new createjs.Tween.get(l)).to({alpha:0},500);(new createjs.Tween.get(f)).to({y:e},400,createjs.Ease.backIn).call(function(){d.unload();s_oGame.nextLevel()})};
this._onRestart=function(){h.setClickable(!1);g.setClickable(!1);(new createjs.Tween.get(l)).to({alpha:0},500);(new createjs.Tween.get(f)).to({y:e},400,createjs.Ease.backIn).call(function(){d.unload();s_oGame.restartGame()})};this._onFinishRolling=function(){};this._onRollingRemoved=function(){};this._onRollingText=function(k){};var d=this;this._init(a,c,b)}
function CLosePanel(a){var c,b,e,f,l;this._init=function(){setVolume(s_aSounds.game_soundtrack,SOUNDTRACK_VOLUME_IN_GAME);b=new createjs.Shape;b.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.alpha=0;b.on("mousedown",function(){});s_oStage.addChild(b);(new createjs.Tween.get(b)).to({alpha:.7},500);e=new createjs.Container;s_oStage.addChild(e);var h=s_oSpriteLibrary.getSprite("msg_box"),d=createBitmap(h);d.regX=h.width/2;d.regY=h.height/2;e.addChild(d);e.x=CANVAS_WIDTH/2;e.y=
CANVAS_HEIGHT+h.height/2;c=e.y;(new createjs.Tween.get(e)).to({y:CANVAS_HEIGHT/2},500,createjs.Ease.quartIn);(new CTLText(e,-300,-100,600,120,60,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_LOSE,ordinal(a),ordinal(MIN_RANK_FOR_WIN)),!0,!0,!0,!1)).setStroke(10,"#000");h=s_oSpriteLibrary.getSprite("but_exit");f=new CGfxButton(0,100,h,e);f.addEventListener(ON_MOUSE_UP,this._onExit,this);h=s_oSpriteLibrary.getSprite("but_restart");l=new CGfxButton(-120,100,h,e);l.addEventListener(ON_MOUSE_UP,this._onRestart,
this);l.setVisible(!1)};this.unload=function(){s_oStage.removeChild(e);b.off("mousedown",function(){});f.unload();l.unload()};this.show=function(){playSound("arrive_lose",1,0)};this._onExit=function(){b.off("mousedown",function(){});s_oStage.removeChild(e);s_oGame.onExit()};this._onRestart=function(){l.setClickable(!1);f.setClickable(!1);(new createjs.Tween.get(b)).to({alpha:0},500);(new createjs.Tween.get(e)).to({y:c},400,createjs.Ease.backIn).call(function(){g.unload();s_oGame.restartGame()})};
var g=this;this._init();return this}
function CTimer(a,c,b,e,f,l,g){var h,d,k;this._init=function(n,p,r,m,t,w,y){h=new createjs.Container;h.x=n;h.y=p;r.addChild(h);n=0;w&&(w=s_oSpriteLibrary.getSprite(w),n=createBitmap(w),n.regY=w.height/2,h.addChild(n),n=w.width);d=new createjs.Text("00:00"," "+m+"px "+PRIMARY_FONT,y);d.x=n+10;d.textAlign="left";d.textBaseline="middle";d.lineWidth=500;d.outline=6;h.addChild(d);k=new createjs.Text(d.text," "+m+"px "+PRIMARY_FONT,t);k.x=d.x;k.y=d.y;k.textAlign=d.textAlign;k.textBaseline=d.textBaseline;
k.lineWidth=d.lineWidth;h.addChild(k);h.regX=h.getBounds().width/2};this.setVisible=function(n){h.visible=n};this.setTime=function(n){d.text=n;k.text=n};this.setDecimalTime=function(n){n=formatTime(n);d.text=n;k.text=n};this.setIntTime=function(n){n=Math.floor(n/1E3);d.text=n;k.text=n};this.setSpeedIndicator=function(n){n=Math.floor(n);d.text=n;k.text=n};this.setAlign=function(n,p){d.textAlign=n;d.textBaseline=p;k.textAlign=d.textAlign;k.textBaseline=d.textBaseline};this.resetTextRelativePos=function(){d.x=
0;d.y=0;k.x=d.x;k.y=d.y;h.regX=0};this.setPos=function(n,p){h.x=n;h.y=p};this._init(a,c,b,e,f,l,g)}
function CTachometer(a,c,b){var e,f,l,g;this._init=function(h,d){e=h;f=d;l=new createjs.Container;l.x=e;l.y=f;b.addChild(l);var k=s_oSpriteLibrary.getSprite("tachometer"),n=createBitmap(k);n.regX=k.width/2;n.regY=k.height;l.addChild(n);(new CTLText(l,-70,-170,140,60,60,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_SPEED_INDICATOR,!0,!0,!1,!1)).setStroke(10,"#000");new CTLText(l,-75,-92,120,60,60,"right","#222222",SECONDARY_FONT,1,0,0,"888",!0,!0,!1,!1);g=new CTLText(l,-75,-92,120,60,60,"right","#fff",SECONDARY_FONT,
1,0,0,"0",!0,!0,!1,!1)};this.setSpeedIndicator=function(h){g.refreshText(Math.floor(h))};this.updateOffset=function(h,d){l.x=e+h;l.y=f-d};this._init(a,c)}
function CMsgBox(a,c){var b,e,f,l,g;this._init=function(d,k){l=new createjs.Shape;l.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);l.alpha=0;l.on("mousedown",function(){});s_oStage.addChild(l);(new createjs.Tween.get(l)).to({alpha:.7},500);g=new createjs.Container;s_oStage.addChild(g);var n=s_oSpriteLibrary.getSprite("msg_box"),p=createBitmap(n);p.regX=n.width/2;p.regY=n.height/2;g.addChild(p);g.x=CANVAS_WIDTH/2;g.y=CANVAS_HEIGHT+n.height/2;b=g.y;(new createjs.Tween.get(g)).to({y:CANVAS_HEIGHT/
2-40},500,createjs.Ease.quartIn);e=new CTLText(g,-300,-190,600,170,26,"center","#fff",PRIMARY_FONT,1,0,0,d,!0,!0,!0,!1);f=new CGfxButton(0,80,s_oSpriteLibrary.getSprite("but_yes"),g);f.addEventListener(ON_MOUSE_UP,this._onButYes,this);f.pulseAnimation()};this._onButYes=function(){f.setClickable(!1);(new createjs.Tween.get(l)).to({alpha:0},500);(new createjs.Tween.get(g)).to({y:b},400,createjs.Ease.backIn).call(function(){h.unload();c&&c()})};this.changeMessage=function(d){e.refreshText(d)};this.unload=
function(){f.unload();s_oStage.removeChild(l);s_oStage.removeChild(g);l.off("mousedown",function(){})};var h=this;this._init(a,c)}
function CAreYouSurePanel(a,c){var b,e,f,l,g,h;this._init=function(k,n){g=new createjs.Shape;g.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);g.alpha=0;g.on("mousedown",function(){});s_oStage.addChild(g);(new createjs.Tween.get(g)).to({alpha:.7},500);h=new createjs.Container;s_oStage.addChild(h);var p=s_oSpriteLibrary.getSprite("msg_box"),r=createBitmap(p);r.regX=p.width/2;r.regY=p.height/2;h.addChild(r);h.x=CANVAS_WIDTH/2;h.y=CANVAS_HEIGHT+p.height/2;b=h.y;(new createjs.Tween.get(h)).to({y:CANVAS_HEIGHT/
2-40},500,createjs.Ease.cubicOut);e=new CTLText(h,-300,-p.height/2+40,600,140,70,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_ARE_SURE,!0,!0,!0,!1);e.setStroke(10,"#000");f=new CGfxButton(110,80,s_oSpriteLibrary.getSprite("but_yes"),h);f.addEventListener(ON_MOUSE_UP,this._onButYes,this);l=new CGfxButton(-110,80,s_oSpriteLibrary.getSprite("but_exit"),h);l.addEventListener(ON_MOUSE_UP,this._onButNo,this);l.pulseAnimation()};this._onButYes=function(){l.setClickable(!1);f.setClickable(!1);(new createjs.Tween.get(g)).to({alpha:0},
500);(new createjs.Tween.get(h)).to({y:b},400,createjs.Ease.backIn).call(function(){d.unload();a&&a()})};this._onButNo=function(){l.setClickable(!1);f.setClickable(!1);(new createjs.Tween.get(g)).to({alpha:0},500);(new createjs.Tween.get(h)).to({y:b},400,createjs.Ease.backIn).call(function(){d.unload();c&&c()})};this.changeMessage=function(k,n){e.refreshText(k)};this.unload=function(){l.unload();f.unload();s_oStage.removeChild(g);s_oStage.removeChild(h);g.off("mousedown",function(){})};var d=this;
this._init(a,c)}
function CAnimSettings(){this._init=function(){this._initCharactersAnims();this._initShadowsAnims();this._initHitParticle()};this._initCharactersAnims=function(){s_aSpriteSheetCharacters=[];for(var a=0;a<s_aFileName.length;a++){for(var c=[],b=0;5>b;b++)c.push(s_oSpriteLibrary.getSprite(s_aFileName[a]+"_"+b));c=this._getCarSpriteData(c);s_aSpriteSheetCharacters[a]=new createjs.SpriteSheet(c)}};this._initShadowsAnims=function(){for(var a=[],c=0;5>c;c++)a.push(s_oSpriteLibrary.getSprite("car_shadow_"+c));
a=this._getCarSpriteData(a);s_oSpriteSheetShadows=new createjs.SpriteSheet(a)};this._initHitParticle=function(){for(var a=[],c=[],b=0;30>b;b++){var e=s_oSpriteLibrary.getSprite("hit_contact_"+b),f=e.width,l=e.height;c.push(e);a.push([0,0,f,l,b,f/2,l/2])}s_oSpriteSheetHitParticle=new createjs.SpriteSheet({framerate:100,images:c,frames:a,animations:{stop:[30,30],start:[0,29,"stop"],idle:[0,29]}})};this._getCarSpriteData=function(a){for(var c=[],b=0;b<a.length;b++){var e=a[b],f=e.width;e=e.height;c.push([0,
0,f,e,b,f/2,e])}return{images:a,frames:c,animations:{center:[0],right_0:[1],right_1:[2],left_0:[3],left_1:[4]}}};this._init()}var s_aSpriteSheetCharacters,s_oSpriteSheetWheelsMask,s_oSpriteSheetShadows,s_oSpriteSheetHitParticle;
function COpponent(a,c,b,e,f,l){var g,h,d,k,n,p,r,m,t,w,y,u,q,E,z,A,C,K,B,O,S,V,R,W,X,Z,x,H,I;this._init=function(G,L,J,M,D,N){z=[];A=[];g=L;h=J;n=N;x=N+1;y=p=H=d=0;u=STATE_RUNNER_RUN;I=!0;q=!1;R=OPPONENT_RUN_STATE_ACCELERATE;L=s_oSpriteLibrary.getSprite(s_aFileName[G]+"_0");w={x:0,y:0,width:L.width,height:L.height};r=new createjs.Container;r.visible=!1;D.addChild(r);X=new CCarShadow(w.width/2,w.height+0,r);X.setFrame("center");t=createSprite(s_aSpriteSheetCharacters[G],"center",0,0,0,0);t.x=w.width/
2;t.y=w.height+0;r.addChild(t);m=new createjs.Shape;m.graphics.beginFill("rgba(255,0,0,0.01)").drawRect(w.x,w.y,w.width,w.height);t.mask=m;Z=new CRankIndicator(w.width/2,-50,r,200);Z.refreshRank(x);this.moveOnSegment()};this.unload=function(){f.removeChild(r)};this.addEventListener=function(G,L,J){z[G]=L;A[G]=J};this.setDifficultyParams=function(G){W=G;var L=percentScale(PLAYER_MAX_SPEED,85),J=percentScale(PLAYER_MAX_SPEED,70);G=10-G;var M=100-2*G,D=100+G,N=100+2*G;C=percentScale(L,100-G);K=percentScale(J,
M);V=percentScale(PLAYER_ACCELERATION,M);O=percentScale(-PLAYER_BRAKING_RATE,N);S=percentScale(-PLAYER_DECELERATION,D)};this.getContainer=function(){return r};this.getSpriteBounds=function(){return w};this.getOffset=function(){return g};this.getZ=function(){return h};this.getRunDistance=function(){return h+(H-1)*TRACK_LENGTH};this.getSpeed=function(){return d};this.getPercent=function(){return k};this.getMask=function(){return m};this.getState=function(){return u};this.getIndex=function(){return n};
this.getCurLife=function(){};this.getDamagePower=function(){};this.canBeRemoved=function(){return q};this.setRank=function(G){x!==G&&(x=G,Z.refreshRank(x))};this.getRank=function(){return x};this.setPosition=function(G){h=G};this.setXOffset=function(G){g=G};this.setVisible=function(G){r.visible=G};this.setAlpha=function(G){r.alpha=G};this.getSkillLevel=function(){return W};this._setDirectionFromCornering=function(){var G=this._getSideFromCornering();X.setFrame(G);t.gotoAndStop(G)};this._calculateCornering=
function(){var G=s_oGame.getRelativeEnemyPosToPlayer(this);s_oGame.getPlayer();G=G!==p?linearFunction(p,-1,1,4,-4):linearFunction(E.curve,ROAD.CURVE.VERYHARD,-ROAD.CURVE.VERYHARD,4,-4);return Math.round(G)};this._getSideFromCornering=function(){var G="center";0<y?(G=y-1,G="right_"+G):0>y&&(G=-y-1,G="left_"+G);return G};this._updateXOffset=function(G,L){var J,M=v.getSpriteBounds().width*SPRITES.ANIMATED.SCALE,D=s_oGame.getSegments();if(G.index-L.getPlayerSegment().index>DRAW_DISTANCE)return r.visible=
!1,0;var N=20;for(J=3;J<N;J++){var U=D[(G.index+J)%D.length];if(U===L.getPlayerSegment()&&d>L.getCurSpeed()&&Util.overlap(L.getPosition().x,L.getPlayerWidth(),g,M,.8)){var F=.5<L.getPosition().x?-1:-.5>L.getPosition().x?1:g>L.getPosition().x?1:-1;return 1*F/J*(d-L.getCurSpeed())/L.getMaxSpeed()}}N=20;for(J=1;J<N;J++){U=D[(G.index+J)%D.length];for(F=0;F<U.enemy.length;F++){var Y=U.enemy[F];var T=Y.getSpriteBounds().width*SPRITES.ANIMATED.SCALE;if(d>Y.getSpeed()&&Util.overlap(g,M,Y.getOffset(),T,.5))return F=
.5<Y.getOffset()?-GENERAL_X_SHIFTING_SPEED:-.5>Y.getOffset()?GENERAL_X_SHIFTING_SPEED:g>Y.getOffset()?GENERAL_X_SHIFTING_SPEED:-GENERAL_X_SHIFTING_SPEED}for(F=0;F<U.cars.length;F++)if(Y=U.cars[F],T=Y.getSprite().width*SPRITES.ANIMATED.SCALE,d>Y.getSpeed()&&Util.overlap(g,M,Y.getOffset(),T,.5))return F=.5<Y.getOffset()?-GENERAL_X_SHIFTING_SPEED:-.5>Y.getOffset()?GENERAL_X_SHIFTING_SPEED:g>Y.getOffset()?GENERAL_X_SHIFTING_SPEED:-GENERAL_X_SHIFTING_SPEED}return this._isAnyoneInTheMiddle(G)?0:-.9>g?.1:
.9<g?-.1:0};this._isAnyoneInTheMiddle=function(G){for(var L,J,M=-10;10>M;M++){L=s_oGame.getValidSegment(G.index+M);for(var D=0;D<L.enemy.length;D++)if(J=L.enemy[D],J=s_oGame.getRelativeEnemyPosToPlayer(J),0>J&&0>p){if(J>p)return!0}else if(0<J&&0<p&&J<p)return!0;for(D=0;D<L.cars.length;D++)if(J=L.cars[D],J=s_oGame.getRelativeEnemyPosToPlayer(J),0>J&&0>p){if(J>p)return!0}else if(0<J&&0<p&&J<p)return!0}return!1};this._accelerate=function(G,L,J){return G+L*J};this._updateSpeed=function(G){B=linearFunction(d,
0,C,V,0);var L=s_oGame.getSegments();R=OPPONENT_RUN_STATE_ACCELERATE;L=L[(E.index+20)%L.length];var J=Util.easeIn(0,30,L.curve/ROAD.CURVE.VERYHARD);J=percentScale(K,J);0>J&&(J*=-1);J=K-J;0!==L.curve&&d>=J&&(R=L.curve>ROAD.CURVE.MEDIUM||L.curve<-ROAD.CURVE.MEDIUM?OPPONENT_RUN_STATE_BRAKE:OPPONENT_RUN_STATE_DECELERATE);switch(R){case OPPONENT_RUN_STATE_BRAKE:d=this._accelerate(d,O,G);d<J&&(d=J);break;case OPPONENT_RUN_STATE_DECELERATE:d=this._accelerate(d,S,G);d<J&&(d=J);break;default:d=this._accelerate(d,
B,G),d>C&&(d=C)}};this.lateralCollision=function(G){var L=1;0>G&&(L=-1);createjs.Tween.get({value:0}).to({value:4*L},200,createjs.Ease.cubicOut).call(function(){}).on("change",function(){g+=L/200})};this._move=function(G){var L=h;h=Util.increase(h,G*d,TRACK_LENGTH);h<L&&(H++,I?I=!1:z[ON_PLAYER_COMPLETE_LAP]&&z[ON_PLAYER_COMPLETE_LAP].call(A[ON_PLAYER_COMPLETE_LAP],H,this))};this.getPlayerSegment=function(){return s_oGame.findSegment(h)};this.getCursor=function(){var G=new createjs.Shape;G.graphics.beginFill(TYPE_CAR_COLOR[a][0]);
G.graphics.drawCircle(0,0,20);G.graphics.beginFill(TYPE_CAR_COLOR[a][1]);G.graphics.drawCircle(0,0,10);return G};this._updateRunAnimation=function(){var G=this._calculateCornering();G!==y&&(y=G,this._setDirectionFromCornering())};this.update=function(G,L){this._updateRunAnimation();this._updateSpeed(G,L);this._move(G);p=s_oGame.getRelativeEnemyPosToPlayer(this);g+=this._updateXOffset(E,L);k=Util.percentRemaining(h,SEGMENT_LENGTH);var J=s_oGame.findSegment(h);if(E.index!==J.index){var M=E.enemy.indexOf(v);
E.enemy.splice(M,1);J.enemy.push(v);E=J}};this.moveOnSegment=function(){k=Util.percentRemaining(h,SEGMENT_LENGTH);E=s_oGame.findSegment(h);E.enemy.push(v)};var v=this;this._init(a,c,b,e,f,l)}function CElement(a,c,b,e){this._aCbCompleted;this._aCbOwner;this._aParams;this._bCollided;this._iXOffset;this._iSegmentIndex;this._oData;this._oSegment;this._oParentContainer;this._oGeneralContainer;this._oElement;this._oMask;this._init(a,c,b,e)}
CElement.prototype._init=function(a,c,b,e){this._aCbCompleted=[];this._aCbOwner=[];this._aParams=[];this._bCollided=!1;this._oParentContainer=e;this._oGeneralContainer=new createjs.Container;this._oParentContainer.addChild(this._oGeneralContainer);this._oContainer=new createjs.Container;this._oGeneralContainer.addChild(this._oContainer);this._iXOffset=c;this._iSegmentIndex=b;this._oData=a;this._createElement();this._setPosition();this._setCollisor();this._oContainer.addChild(this._oElement);this._oGeneralContainer.visible=
!1;a=this._oContainer.getBounds();this._oGeneralContainer.setBounds(a.x,a.y,a.width,a.height);this._oMask=new createjs.Shape;this._oMask.graphics.beginFill("rgba(255,0,0,0.01)").drawRect(a.x,a.y,a.width,a.height);this._oContainer.mask=this._oMask};CElement.prototype.unload=function(){this._oParentContainer.removeChild(this._oGeneralContainer)};CElement.prototype.getElement=function(){return this._oElement};CElement.prototype.getContainer=function(){return this._oGeneralContainer};
CElement.prototype._setPosition=function(){this._oElement.regX=this._oElement.getBounds().width/2;var a=this._oData.physics;a&&(a.hasOwnProperty("center")&&(this._oElement.regX=a.center),a.hasOwnProperty("base")&&(this._oElement.regY=-a.base))};
CElement.prototype._setCollisor=function(){var a=this._oElement.getBounds().width*SPRITES.SCALE,c=this._oData.physics,b=this._iXOffset;this._oElement.getBounds();c&&(c.hasOwnProperty("center")&&(b=this._iXOffset),c.hasOwnProperty("width")&&(a=c.width*SPRITES.SCALE));this._oCollision={center:b,width:a}};CElement.prototype.getCollisor=function(){return this._oCollision};CElement.prototype.isCollided=function(){return this._bCollided};CElement.prototype.pause=function(a){this._oElement.paused=a};
CElement.prototype.getOffset=function(){return this._iXOffset};CElement.prototype.getMask=function(){return this._oMask};CElement.prototype.setVisible=function(a){this._oGeneralContainer.visible=a};CElement.prototype.setAlpha=function(a){this._oGeneralContainer.alpha=a};CElement.prototype.setPosition=function(a,c){this._oElement.x=a;this._oElement.y=c};CElement.prototype.getSegmentIndex=function(){return this._iSegmentIndex};CElement.prototype.setScale=function(a){this._oElement.scale=a};
CElement.prototype.addEventListener=function(a,c,b,e){this._aCbCompleted[a]=c;this._aCbOwner[a]=b;this._aParams=e};CElement.prototype.triggerCollision=function(){this._aCbCompleted[ON_ITEM_COLLISION]&&this._aCbCompleted[ON_ITEM_COLLISION].call(this._aCbOwner[ON_ITEM_COLLISION],this,this._aParams)};function CElementStatic(a,c,b,e){CElement.call(this,a,c,b,e)}CElementStatic.prototype=Object.create(CElement.prototype);
CElementStatic.prototype._createElement=function(){var a=s_oSpriteLibrary.getSprite(this._oData.name);this._oElement=createBitmap(a)};CElementStatic.prototype.setCollided=function(a){this._bCollided=a};
function CHitParticle(a,c,b){var e,f;this._init=function(l,g,h){e=new createjs.Container;e.x=l;e.y=g;h.addChild(e);f=createSprite(s_oSpriteSheetHitParticle,"stop",0,0,0,0);e.addChild(f)};this.unload=function(){b.removeChild(e)};this.play=function(l,g){playSound("crash",1,!1);f.x=l;f.y=g;f.gotoAndPlay("start")};this._init(a,c,b)}
function CMiniMap(a,c,b){var e,f,l,g,h,d,k,n,p,r,m,t;this._init=function(){e=.2;f=20;l=.122727;d=new createjs.Container;b.addChild(d);var w=350,y=225;g=new createjs.Rectangle(-w/2,-y/2,w,y);var u=s_oSpriteLibrary.getSprite("map_panel");w=createBitmap(u);w.regX=u.width/2;w.regY=u.height/2;d.addChild(w);w=u.width;y=50;m=new CTLText(d,-w/2,-u.height/2-y,w,y,50,"center","#fff",PRIMARY_FONT,1,2,2," ",!0,!0,!1,!1);m.setStroke(8,"#000");k=new createjs.Container;d.addChild(k);n=new createjs.Container;k.addChild(n);
h=[];p=new createjs.Container;k.addChild(p);r=new createjs.Container;k.addChild(r);t=[]};this.unload=function(){b.removeChild(d)};this.setPosition=function(w,y){d.x=w;d.y=y+g.height/2};this.setPath=function(w){var y={x:0,y:-1},u={x:0,y:0,angle:0},q=new createjs.Shape;q.graphics.setStrokeStyle(f);q.graphics.beginStroke("white");q.graphics.moveTo(u.x,u.y);n.addChild(q);for(var E=0,z=u.x,A=u.x,C=u.y,K=u.y,B=0;B<w.length;B++){var O=-w[B].curve*l;E-=O;O=degreesToRadians(O);y=rotateSimpleVector2D(O,y);
u={x:u.x+y.x*e,y:u.y+y.y*e,angle:E};q.graphics.lineTo(u.x,u.y);h.push(u);u.x<z&&(z=u.x);u.x>A&&(A=u.x);u.y<C&&(C=u.y);u.y>K&&(K=u.y)}q.setBounds(z,C,A-z,K-C);k.regX=q.getBounds().x+q.getBounds().width/2;k.regY=q.getBounds().y+q.getBounds().height/2;this._setMapInRectView();this._addIcon()};this._setMapInRectView=function(){var w=g.width-50,y=g.height-50;w=inRectResize(k.getBounds(),w,y);k.scale=w};this._addIcon=function(){var w=h[h.length-1],y=s_oSpriteLibrary.getSprite("end_icon_map"),u=createBitmap(y);
u.regX=y.width/2;u.regY=y.height/2;u.x=w.x;u.y=w.y;u.rotation=w.angle;u.scale=2;r.addChild(u)};this.addCursor=function(w,y){t.push({image:w,owner:y});p.addChild(w)};this.setMapViewInfo=function(w,y,u,q){k.x=w;k.y=y;k.scale=u;k.rotation=q};this.setLabel=function(w){};this.setScale=function(w){d.scale=w};this.update=function(){for(var w=0;w<t.length;w++){var y=t[w],u=y.owner.getPlayerSegment().index;u=h[u];y.image.x=u.x;y.image.y=u.y;y.image.rotation=u.angle}};this._init()}
function CGameRace(a,c){CGameBase.call(this,a,c);this._iCurPlayerLap;this._iTotLap;this._aRankPositions;this._startGame()}CGameRace.prototype=Object.create(CGameBase.prototype);
CGameRace.prototype._startGame=function(){this._iCurPlayerLap=1;this._iTotLap=LEVEL_INFO[this._iLevel].num_laps;this._oPlayer.addEventListener(ON_PLAYER_COMPLETE_LAP,this.playerLapCompleted,this);this._oPlayer.addEventListener(ON_PLAYER_CHANGE_RANK,this.playerRankChanged,this);var a=this.getStartingGrid(STARTING_GRID_X_OFFSET,STARTING_GRID_Z_OFFSET,TYPE_CAR_IN_GAME.length),c=copyObjectByValue(TYPE_CAR_IN_GAME);c.shift();shuffle(c);for(var b=0;b<c.length;b++)this.createOpponent(c[b],Math.random()*
OVERALL_DIFFICULTY,b);c=this._aEnemy.concat([this._oPlayer]);this.setStartingGrid(c,a);a=this._oPlayer.getCursor();this._oInterface.addMiniMapCursor(a,this._oPlayer);this._oInterface.refreshLap(this._iCurPlayerLap,this._iTotLap);this._oRoad.clearElementsInSegments(0,this._aSegments.length);this.updateOpponents(0);this.refreshRanks()};CGameRace.prototype.getStartingGrid=function(a,c,b){var e=[];a*=-1;for(var f=10+c,l=0;l<b;l++)e.push({x:a,z:f}),f+=c,a*=-1;return e};
CGameRace.prototype.setStartingGrid=function(a,c){for(var b=0;b<a.length;b++){var e=a[b],f=c[b].x;e.setPosition((this._aSegments.length-c[b].z)*SEGMENT_LENGTH);e.setXOffset(f)}};CGameRace.prototype.createOpponent=function(a,c,b){a=new COpponent(a,0,0,0,this._oElementContainer,b);a.addEventListener(ON_PLAYER_COMPLETE_LAP,this.enemyLapCompleted,this);a.setDifficultyParams(c);c=a.getCursor();this._oInterface.addMiniMapCursor(c,a);this._aEnemy.push(a)};
CGameRace.prototype.enemyLapCompleted=function(a,c){var b=c.getRunDistance(c);b=this._oPlayer.getRunDistance(c)-b;var e=this._oRoad.getTrackLength(),f=b/e*100;b=c.getSkillLevel();var l=this._iTotLap-a;0>f?(e=0,-5<f?e=.5:-5>f&&(e=1),f=linearFunction(l,1,this._iTotLap,e,0),b-=e+f):(e=0,5<f&&(e=.5),50<f&&100>f&&(e=1),f=linearFunction(l,1,this._iTotLap,0,e),b+=e+f);c.setDifficultyParams(b)};
CGameRace.prototype.playerLapCompleted=function(a){this._iCurPlayerLap=a;this._iCurPlayerLap>=this._iTotLap?this.trackCompleted():this._iTimeElaps=0;this._oInterface.refreshLap(this._iCurPlayerLap,this._iTotLap)};CGameRace.prototype.playerRankChanged=function(a){this._oInterface.refreshRankPosition(a)};
CGameRace.prototype.getRankList=function(){for(var a=this._oPlayer.getRunDistance(),c=[],b=0;b<this._aEnemy.length;b++)c.push({index:b,distance:this._aEnemy[b].getRunDistance()});c.push({index:"player",distance:a});c.sort(function(e,f){return f.distance-e.distance});return c};CGameRace.prototype.refreshRanks=function(){this._aRankPositions=this.getRankList();for(var a=0;a<this._aRankPositions.length;a++){var c=this._aRankPositions[a],b=a+1;"player"!==c.index?this._aEnemy[c.index].setRank(b):this._oPlayer.setRank(b)}};
CGameRace.prototype.trackCompleted=function(){if(this._iGameState!==STATE_GAME_END){$(s_oMain).trigger("end_level",this._iLevel);$(s_oMain).trigger("show_interlevel_ad");this._iGameState=STATE_GAME_END;s_oGame.stopPlayer();var a=this._oPlayer.getRank();if(a<=MIN_RANK_FOR_WIN){this._iScore=Math.floor(POINTS_PER_RANK[a-1]);new CNextLevelPanel(a,this._iScore,this._iLevel);this._iScore>s_aLevelScore[this._iLevel]&&(s_aLevelScore[this._iLevel]=this._iScore,s_oLocalStorage.saveData());for(var c=a=0;c<s_aLevelScore.length;c++)a+=
s_aLevelScore[c];$(s_oMain).trigger("save_score",a)}else(new CLosePanel(a)).show()}};CGameRace.prototype.updateOpponents=function(a){for(var c=0;c<this._aEnemy.length;c++)this._aEnemy[c].update(a,this._oPlayer)};CGameRace.prototype.updateRace=function(a){this.updateOpponents(a);this.refreshRanks()};
function CLapIndicator(a,c,b){var e,f,l,g;this._init=function(){e=a;f=c;l=new createjs.Container;l.x=a;l.y=c;b.addChild(l);var h=s_oSpriteLibrary.getSprite("lap_panel"),d=createBitmap(h);d.regX=h.width/2;d.regY=0;l.addChild(d);g=new CTLText(l,-20,19,140,70,70,"center","#fff",PRIMARY_FONT,1,2,2,sprintf(TEXT_LAP,0,0),!0,!0,!1,!1);g.setStroke(10,"#000")};this.unload=function(){b.removeChild(l)};this.setPosition=function(){l.x=e;l.y=f+s_iOffsetY};this.refreshLap=function(h,d){var k=sprintf(TEXT_LAP,h,
d);g.refreshText(k)};this.setVisible=function(h){l.visible=h};this._init()}
!function(){function a(f){var l=f;if(e[l])l=e[l];else{for(var g=l,h,d=[],k=0;g;){if(null!==(h=b.text.exec(g)))d.push(h[0]);else if(null!==(h=b.modulo.exec(g)))d.push("%");else if(null!==(h=b.placeholder.exec(g))){if(h[2]){k|=1;var n=[],p=h[2],r;if(null!==(r=b.key.exec(p)))for(n.push(r[1]);""!==(p=p.substring(r[0].length));)if(null!==(r=b.key_access.exec(p)))n.push(r[1]);else if(null!==(r=b.index_access.exec(p)))n.push(r[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");
else throw new SyntaxError("[sprintf] failed to parse named argument key");h[2]=n}else k|=2;if(3===k)throw Error("[sprintf] mixing positional and named placeholders is not (yet) supported");d.push({placeholder:h[0],param_no:h[1],keys:h[2],sign:h[3],pad_char:h[4],align:h[5],width:h[6],precision:h[7],type:h[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");g=g.substring(h[0].length)}l=e[l]=d}g=arguments;h=1;d=l.length;n="";var m,t;for(p=0;p<d;p++)if("string"===typeof l[p])n+=l[p];
else if("object"===typeof l[p]){r=l[p];if(r.keys)for(k=g[h],m=0;m<r.keys.length;m++){if(void 0==k)throw Error(a('[sprintf] Cannot access property "%s" of undefined value "%s"',r.keys[m],r.keys[m-1]));k=k[r.keys[m]]}else k=r.param_no?g[r.param_no]:g[h++];b.not_type.test(r.type)&&b.not_primitive.test(r.type)&&k instanceof Function&&(k=k());if(b.numeric_arg.test(r.type)&&"number"!==typeof k&&isNaN(k))throw new TypeError(a("[sprintf] expecting number but found %T",k));b.number.test(r.type)&&(t=0<=k);
switch(r.type){case "b":k=parseInt(k,10).toString(2);break;case "c":k=String.fromCharCode(parseInt(k,10));break;case "d":case "i":k=parseInt(k,10);break;case "j":k=JSON.stringify(k,null,r.width?parseInt(r.width):0);break;case "e":k=r.precision?parseFloat(k).toExponential(r.precision):parseFloat(k).toExponential();break;case "f":k=r.precision?parseFloat(k).toFixed(r.precision):parseFloat(k);break;case "g":k=r.precision?String(Number(k.toPrecision(r.precision))):parseFloat(k);break;case "o":k=(parseInt(k,
10)>>>0).toString(8);break;case "s":k=String(k);k=r.precision?k.substring(0,r.precision):k;break;case "t":k=String(!!k);k=r.precision?k.substring(0,r.precision):k;break;case "T":k=Object.prototype.toString.call(k).slice(8,-1).toLowerCase();k=r.precision?k.substring(0,r.precision):k;break;case "u":k=parseInt(k,10)>>>0;break;case "v":k=k.valueOf();k=r.precision?k.substring(0,r.precision):k;break;case "x":k=(parseInt(k,10)>>>0).toString(16);break;case "X":k=(parseInt(k,10)>>>0).toString(16).toUpperCase()}if(b.json.test(r.type))n+=
k;else{if(!b.number.test(r.type)||t&&!r.sign)var w="";else w=t?"+":"-",k=k.toString().replace(b.sign,"");m=r.pad_char?"0"===r.pad_char?"0":r.pad_char.charAt(1):" ";var y=r.width-(w+k).length;y=r.width?0<y?m.repeat(y):"":"";n+=r.align?w+k+y:"0"===m?w+y+k:y+w+k}}return n}function c(f,l){return a.apply(null,[f].concat(l||[]))}var b={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,
placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/},e=Object.create(null);"undefined"!==typeof exports&&(exports.sprintf=a,exports.vsprintf=c);"undefined"!==typeof window&&(window.sprintf=a,window.vsprintf=c,"function"===typeof define&&define.amd&&define(function(){return{sprintf:a,vsprintf:c}}))}();
function CCarShadow(a,c,b){var e,f;this._init=function(){e=new createjs.Container;e.x=a;e.y=c;b.addChild(e);f=createSprite(s_oSpriteSheetShadows,"center",0,0,0,0);f.gotoAndStop("center");e.addChild(f)};this.unload=function(){b.removeAllChildren(e)};this.setFrame=function(l){f.gotoAndStop(l)};this._init()}
function CRankIndicator(a,c,b,e){var f,l,g,h,d;this._init=function(){f=a;l=c;g=new createjs.Container;g.x=a;g.y=c;b.addChild(g);var k=100;h=new CTLText(g,-100,-(k/2),100,k,e,"right","#fff",PRIMARY_FONT,1,2,2,"--",!0,!0,!1,!1);k=70;d=new CTLText(g,0,-15-k/2,70,k,e/2,"left","#fff",THIRD_FONT,1,2,2,"-",!0,!0,!1,!1)};this.unload=function(){b.removeChild(g)};this.refreshPosition=function(k,n){g.x=f+k;g.y=l+n};this.refreshRank=function(k){h.refreshText(k.toString());var n=ordinalSuffix(k);d.refreshText(n);
this.setColorBasedOnRank(k)};this.center=function(){var k=h.getText().getBounds().width,n=d.getText().getBounds().width;g.x=-n+(k+n)/2+120};this.alignLeft=function(){var k=h.getText().getBounds().width,n=d.getText().getBounds().width;g.x=-n+(k+n)};this.setColorBasedOnRank=function(k){var n=k-1,p=TYPE_CUP_COLOR[3][0],r=TYPE_CUP_COLOR[3][1];k<=MIN_RANK_FOR_WIN&&(p=TYPE_CUP_COLOR[n][0],r=TYPE_CUP_COLOR[n][1]);h.setColor(p);d.setColor(p);h.setStroke(10,r);d.setStroke(10,r)};this.setOutline=function(){h.setStroke(10,
"#000");d.setStroke(10,"#000")};this._init()};